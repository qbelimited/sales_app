"use strict";(self.webpackChunkSales_tracking_app=self.webpackChunkSales_tracking_app||[]).push([[304],{2304:(e,s,r)=>{r.r(s),r.d(s,{default:()=>p});var a=r(5043),l=r(7417),t=r(1072),n=r(8602),c=r(3814),i=r(4282),d=r(4196),o=r(2725),h=r(4063),u=r(3204),x=r(9621),j=r(579);const m=e=>{let{endpoint:s,columns:r,title:m,showToast:p}=e;const[A,v]=(0,a.useState)([]),[g,b]=(0,a.useState)(!0),[y,C]=(0,a.useState)(null),[f,N]=(0,a.useState)("created_at"),[w,S]=(0,a.useState)("asc"),[k,_]=(0,a.useState)(""),[$,E]=(0,a.useState)(10),[U,H]=(0,a.useState)(1),[B,P]=(0,a.useState)(0),[G,L]=(0,a.useState)(1),[R,F]=(0,a.useState)(!1),[T,z]=(0,a.useState)(null),[I,D]=(0,a.useState)([]),[M,J]=(0,a.useState)([]),[O,X]=(0,a.useState)([]),[q,W]=(0,a.useState)(!1),[K,Q]=(0,a.useState)(""),[V,Y]=(0,a.useState)(""),[Z,ee]=(0,a.useState)(!1),[se,re]=(0,a.useState)(null),[ae,le]=(0,a.useState)(!1),[te,ne]=(0,a.useState)({email:"",name:"",role_id:"",branches:[],is_active:!0,is_deleted:!1}),ce=(0,a.useCallback)((async()=>{try{const e=await x.A.get("/branches/?sort_by=created_at&per_page=1000&page=1");D(e.data.branches||[])}catch(y){console.error("Error fetching branches:",y)}}),[]),ie=(0,a.useCallback)((async()=>{try{const e=await x.A.get("/roles/");X(e.data||[])}catch(y){console.error("Error fetching roles:",y)}}),[]),de=(0,a.useCallback)((async()=>{b(!0),C(null);try{const e=await x.A.get(s,{params:{sort_by:f,sort_direction:w,filter_by:k,per_page:$,page:U}});v(e.data.users||[]),P(e.data.total||0),L(e.data.pages||1)}catch(y){console.error("Error fetching data:",y),C("Failed to fetch data. Please try again later."),p("danger","Failed to fetch data. Please try again later.","Error")}finally{b(!1)}}),[s,f,w,k,$,U,p]);(0,a.useEffect)((()=>{de(),ce(),ie()}),[de,ce,ie]);const oe=e=>{J((s=>s.includes(e)?s.filter((s=>s!==e)):[...s,e]))};return g?(0,j.jsx)(l.A,{animation:"border"}):(0,j.jsxs)("div",{children:[(0,j.jsxs)(t.A,{className:"mb-3",children:[(0,j.jsx)(n.A,{children:(0,j.jsx)("h2",{children:m})}),(0,j.jsx)(n.A,{className:"text-right",children:(0,j.jsxs)("h5",{children:["Total Users: ",B]})})]}),y&&(0,j.jsx)("p",{className:"text-center text-danger",children:y}),(0,j.jsxs)(t.A,{className:"mb-3",children:[(0,j.jsx)(n.A,{md:4,children:(0,j.jsx)(c.A.Control,{type:"text",placeholder:"Filter by keyword",value:k,onChange:e=>{_(e.target.value),H(1)}})}),(0,j.jsx)(n.A,{md:4,children:(0,j.jsxs)(c.A.Control,{as:"select",value:$,onChange:e=>{E(Number(e.target.value)),H(1)},children:[(0,j.jsx)("option",{value:5,children:"5 per page"}),(0,j.jsx)("option",{value:10,children:"10 per page"}),(0,j.jsx)("option",{value:20,children:"20 per page"})]})}),(0,j.jsx)(n.A,{md:4,className:"text-right",children:(0,j.jsxs)(i.A,{variant:"primary",onClick:()=>le(!0),children:[(0,j.jsx)(u.OiG,{})," Add User"]})})]}),(0,j.jsxs)(d.A,{striped:!0,bordered:!0,hover:!0,responsive:!0,children:[(0,j.jsx)("thead",{children:(0,j.jsxs)("tr",{children:[(0,j.jsx)("th",{children:"#"}),r.map((e=>{return(0,j.jsxs)("th",{onClick:()=>{return s=e.accessor,void(f===s?S((e=>"asc"===e?"desc":"asc")):(N(s),S("asc")));var s},style:{cursor:"pointer"},"aria-sort":f===e.accessor?w:"none",children:[e.Header," ",(s=e.accessor,f===s?"asc"===w?(0,j.jsx)(u.XhJ,{}):(0,j.jsx)(u.GOR,{}):(0,j.jsx)(u.MjW,{}))]},e.accessor);var s})),(0,j.jsx)("th",{children:"Actions"})]})}),(0,j.jsx)("tbody",{children:A.length>0?A.map(((e,s)=>(0,j.jsxs)("tr",{children:[(0,j.jsx)("td",{children:(U-1)*$+s+1}),r.map((s=>(0,j.jsx)("td",{children:"function"===typeof s.accessor?s.accessor(e):e[s.accessor]},s.Header))),(0,j.jsxs)("td",{children:[(0,j.jsx)(i.A,{variant:"link",size:"sm",onClick:()=>{return s=e,z({...s,role_id:s.role?s.role.id:""}),J(s.branches?s.branches.map((e=>e.id)):[]),void F(!0);var s},children:(0,j.jsx)(u.F7,{})}),(0,j.jsx)(i.A,{variant:"link",size:"sm",onClick:()=>(z(e),void W(!0)),children:(0,j.jsx)(u.pXu,{})}),(0,j.jsx)(i.A,{variant:"link",size:"sm",onClick:()=>{return s=e.id,re(s),void ee(!0);var s},children:(0,j.jsx)(u.qbC,{})})]})]},e.id))):(0,j.jsx)("tr",{children:(0,j.jsx)("td",{colSpan:r.length+2,className:"text-center",children:"No records found"})})})]}),(0,j.jsxs)(t.A,{className:"align-items-center",children:[(0,j.jsx)(n.A,{md:"auto",children:(0,j.jsxs)("p",{className:"mb-0",children:["Showing ",(U-1)*$+1," to ",Math.min(U*$,B)," of"," ",B," users"]})}),(0,j.jsx)(n.A,{md:"auto",children:(0,j.jsxs)("p",{className:"mb-0",children:["Page ",U," of ",G]})}),(0,j.jsxs)(n.A,{md:"auto",className:"ml-auto",children:[(0,j.jsx)(i.A,{variant:"primary",onClick:()=>H(U-1),disabled:1===U,children:"Previous"})," ",(0,j.jsx)(i.A,{variant:"primary",onClick:()=>H(U+1),disabled:U===G,children:"Next"})]})]}),T&&(0,j.jsxs)(o.A,{show:R,onHide:()=>F(!1),children:[(0,j.jsx)(o.A.Header,{closeButton:!0,children:(0,j.jsx)(o.A.Title,{children:"Edit User"})}),(0,j.jsx)(o.A.Body,{children:(0,j.jsxs)(c.A,{children:[(0,j.jsxs)(c.A.Group,{className:"mb-3",children:[(0,j.jsx)(c.A.Label,{children:"Name"}),(0,j.jsx)(c.A.Control,{type:"text",value:T.name,onChange:e=>z({...T,name:e.target.value})})]}),(0,j.jsxs)(c.A.Group,{className:"mb-3",children:[(0,j.jsx)(c.A.Label,{children:"Email"}),(0,j.jsx)(c.A.Control,{type:"email",value:T.email,onChange:e=>z({...T,email:e.target.value})})]}),(0,j.jsxs)(c.A.Group,{className:"mb-3",children:[(0,j.jsx)(c.A.Label,{children:"Role"}),(0,j.jsx)(c.A.Control,{as:"select",value:T.role_id||"",onChange:e=>z({...T,role_id:parseInt(e.target.value,10)}),children:O.map((e=>(0,j.jsx)("option",{value:e.id,children:e.name},e.id)))})]}),(0,j.jsxs)(c.A.Group,{className:"mb-3",children:[(0,j.jsx)(c.A.Label,{children:"Branches"}),(0,j.jsxs)(c.A.Control,{as:"select",onChange:e=>oe(parseInt(e.target.value,10)),value:"",children:[(0,j.jsx)("option",{value:"",disabled:!0,children:"Select Branch to Add"}),I.filter((e=>!M.includes(e.id))).map((e=>(0,j.jsx)("option",{value:e.id,children:e.name},e.id)))]}),(0,j.jsx)("div",{className:"mt-2",children:M.map((e=>{const s=I.find((s=>s.id===e));return(0,j.jsxs)(h.A,{pill:!0,variant:"primary",className:"mr-2",children:[s?s.name:e,(0,j.jsx)(i.A,{variant:"link",size:"sm",onClick:()=>oe(e),className:"ml-1 text-white",children:"x"})]},e)}))})]})]})}),(0,j.jsxs)(o.A.Footer,{children:[(0,j.jsx)(i.A,{variant:"secondary",onClick:()=>F(!1),children:"Close"}),(0,j.jsx)(i.A,{variant:"primary",onClick:async()=>{try{await x.A.put(`/users/${T.id}`,{...T,branches:M,role_id:parseInt(T.role_id,10)}),v((e=>e.map((e=>e.id===T.id?T:e)))),F(!1),p("success","User updated successfully.","Success")}catch(y){console.error("Error updating user:",y),p("danger","Error updating user","Error")}},children:"Save Changes"})]})]}),(0,j.jsxs)(o.A,{show:ae,onHide:()=>le(!1),children:[(0,j.jsx)(o.A.Header,{closeButton:!0,children:(0,j.jsx)(o.A.Title,{children:"Add User"})}),(0,j.jsx)(o.A.Body,{children:(0,j.jsxs)(c.A,{children:[(0,j.jsxs)(c.A.Group,{className:"mb-3",children:[(0,j.jsx)(c.A.Label,{children:"Name"}),(0,j.jsx)(c.A.Control,{type:"text",value:te.name,onChange:e=>ne({...te,name:e.target.value})})]}),(0,j.jsxs)(c.A.Group,{className:"mb-3",children:[(0,j.jsx)(c.A.Label,{children:"Email"}),(0,j.jsx)(c.A.Control,{type:"email",value:te.email,onChange:e=>ne({...te,email:e.target.value})})]}),(0,j.jsxs)(c.A.Group,{className:"mb-3",children:[(0,j.jsx)(c.A.Label,{children:"Role"}),(0,j.jsxs)(c.A.Control,{as:"select",value:te.role_id||"",onChange:e=>ne({...te,role_id:parseInt(e.target.value,10)}),children:[(0,j.jsx)("option",{value:"",disabled:!0,children:"Select Role"}),O.map((e=>(0,j.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,j.jsxs)(c.A.Group,{className:"mb-3",children:[(0,j.jsx)(c.A.Label,{children:"Branches"}),(0,j.jsxs)(c.A.Control,{as:"select",onChange:e=>oe(parseInt(e.target.value,10)),value:"",children:[(0,j.jsx)("option",{value:"",disabled:!0,children:"Select Branch to Add"}),I.map((e=>(0,j.jsx)("option",{value:e.id,children:e.name},e.id)))]}),(0,j.jsx)("div",{className:"mt-2",children:te.branches.map((e=>{const s=I.find((s=>s.id===e));return(0,j.jsxs)(h.A,{pill:!0,variant:"primary",className:"mr-2",children:[s?s.name:e,(0,j.jsx)(i.A,{variant:"link",size:"sm",onClick:()=>oe(e),className:"ml-1 text-white",children:"x"})]},e)}))})]})]})}),(0,j.jsxs)(o.A.Footer,{children:[(0,j.jsx)(i.A,{variant:"secondary",onClick:()=>le(!1),children:"Close"}),(0,j.jsx)(i.A,{variant:"primary",onClick:async()=>{try{const e=await x.A.post("/users/",{...te,branches:M});v((s=>[...s,e.data])),p("success","User added successfully!","Success"),le(!1),ne({email:"",name:"",role_id:"",branches:[],is_active:!0,is_deleted:!1})}catch(y){console.error("Error adding user:",y),p("danger","Error adding user","Error")}},children:"Add User"})]})]}),T&&(0,j.jsxs)(o.A,{show:q,onHide:()=>W(!1),children:[(0,j.jsx)(o.A.Header,{closeButton:!0,children:(0,j.jsx)(o.A.Title,{children:"Update Password"})}),(0,j.jsx)(o.A.Body,{children:(0,j.jsx)(c.A,{children:(0,j.jsxs)(c.A.Group,{children:[(0,j.jsx)(c.A.Label,{children:"New Password"}),(0,j.jsx)(c.A.Control,{type:"password",placeholder:"Enter new password",value:K,onChange:e=>Q(e.target.value)})]})})}),(0,j.jsxs)(o.A.Footer,{children:[(0,j.jsx)(i.A,{variant:"secondary",onClick:()=>W(!1),children:"Close"}),(0,j.jsx)(i.A,{variant:"primary",onClick:async()=>{try{await x.A.put(`/users/${T.id}/password`,{current_password:V,new_password:K}),p("success","Password updated successfully!","Success"),W(!1),Q(""),Y("")}catch(y){console.error("Password update failed:",y),p("danger","Failed to update password! Please try again.","Error")}},children:"Update Password"})]})]}),(0,j.jsxs)(o.A,{show:Z,onHide:()=>ee(!1),children:[(0,j.jsx)(o.A.Header,{closeButton:!0,children:(0,j.jsx)(o.A.Title,{children:"Confirm Deletion"})}),(0,j.jsx)(o.A.Body,{children:"Are you sure you want to delete this user? This action cannot be undone."}),(0,j.jsxs)(o.A.Footer,{children:[(0,j.jsx)(i.A,{variant:"secondary",onClick:()=>ee(!1),children:"Cancel"}),(0,j.jsx)(i.A,{variant:"danger",onClick:async()=>{try{await x.A.delete(`/users/${se}`),v(A.filter((e=>e.id!==se))),p("success","User deleted successfully","Success")}catch(y){console.error("Error deleting user:",y),p("danger","Error deleting user","Error")}finally{ee(!1),re(null)}},children:"Delete"})]})]})]})},p=e=>{let{showToast:s}=e;const r=[{Header:"Name",accessor:"name"},{Header:"Email",accessor:"email"},{Header:"Role",accessor:e=>e.role&&e.role.name?e.role.name:"No Role"},{Header:"Created At",accessor:e=>new Date(e.created_at).toLocaleDateString()}];return(0,j.jsxs)("div",{className:"container mt-5",children:[(0,j.jsx)("h1",{className:"text-center mb-4",children:"Manage Users"}),(0,j.jsx)(m,{endpoint:"/users/",columns:r,title:"Users List",showToast:s})]})}},4063:(e,s,r)=>{r.d(s,{A:()=>d});var a=r(8139),l=r.n(a),t=r(5043),n=r(7852),c=r(579);const i=t.forwardRef(((e,s)=>{let{bsPrefix:r,bg:a="primary",pill:t=!1,text:i,className:d,as:o="span",...h}=e;const u=(0,n.oU)(r,"badge");return(0,c.jsx)(o,{ref:s,...h,className:l()(d,u,t&&"rounded-pill",i&&`text-${i}`,a&&`bg-${a}`)})}));i.displayName="Badge";const d=i},1072:(e,s,r)=>{r.d(s,{A:()=>d});var a=r(8139),l=r.n(a),t=r(5043),n=r(7852),c=r(579);const i=t.forwardRef(((e,s)=>{let{bsPrefix:r,className:a,as:t="div",...i}=e;const d=(0,n.oU)(r,"row"),o=(0,n.gy)(),h=(0,n.Jm)(),u=`${d}-cols`,x=[];return o.forEach((e=>{const s=i[e];let r;delete i[e],null!=s&&"object"===typeof s?({cols:r}=s):r=s;const a=e!==h?`-${e}`:"";null!=r&&x.push(`${u}${a}-${r}`)})),(0,c.jsx)(t,{ref:s,...i,className:l()(a,d,...x)})}));i.displayName="Row";const d=i},4196:(e,s,r)=>{r.d(s,{A:()=>i});var a=r(8139),l=r.n(a),t=r(5043),n=r(7852),c=r(579);const i=t.forwardRef(((e,s)=>{let{bsPrefix:r,className:a,striped:t,bordered:i,borderless:d,hover:o,size:h,variant:u,responsive:x,...j}=e;const m=(0,n.oU)(r,"table"),p=l()(a,m,u&&`${m}-${u}`,h&&`${m}-${h}`,t&&`${m}-${"string"===typeof t?`striped-${t}`:"striped"}`,i&&`${m}-bordered`,d&&`${m}-borderless`,o&&`${m}-hover`),A=(0,c.jsx)("table",{...j,className:p,ref:s});if(x){let e=`${m}-responsive`;return"string"===typeof x&&(e=`${e}-${x}`),(0,c.jsx)("div",{className:e,children:A})}return A}))}}]);
//# sourceMappingURL=304.d01cd66b.chunk.js.map