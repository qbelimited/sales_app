"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[893],{7893:(e,s,r)=>{r.r(s),r.d(s,{default:()=>g});var t=r(5043),a=r(1072),n=r(8602),l=r(3814),i=r(4282),c=r(4196),d=r(5751),o=r(3204),h=r(1899),x=r.n(h),j=(r(5015),r(9621)),u=r(579);const g=e=>{let{showToast:s}=e;const[r,h]=(0,t.useState)([]),[g,m]=(0,t.useState)({}),[p,A]=(0,t.useState)(!0),[y,D]=(0,t.useState)(null),[v,f]=(0,t.useState)({resourceType:"",action:"",startDate:null,endDate:null}),[N,k]=(0,t.useState)(!1),[C,w]=(0,t.useState)(null),[S,_]=(0,t.useState)([]),[T,b]=(0,t.useState)([]),[E,F]=(0,t.useState)(1),[P]=(0,t.useState)(50),[U,R]=(0,t.useState)("current"),I=(0,t.useCallback)((async()=>{A(!0),D(null);try{const e=(await j.A.get("/audit_trail/")).data||[];h(e),M(e)}catch(y){console.error("Error fetching audit logs:",y),D("Failed to fetch audit logs. Please try again later."),s("danger","Failed to fetch audit logs. Please try again later.","Error")}finally{A(!1)}}),[s]),M=e=>{const s=[...new Set(e.map((e=>e.resource_type)))],r=[...new Set(e.map((e=>e.action.replace("AuditAction.",""))))];_(s),b(r)},L=(0,t.useCallback)((async()=>{try{const e=await j.A.get("/users/"),s={};e.data.users.forEach((e=>{s[e.id]=e.name})),m(s)}catch(y){console.error("Error fetching users:",y)}}),[]);(0,t.useEffect)((()=>{I(),L()}),[I,L]);const B=r.filter((e=>{const s=new Date(e.timestamp),r=new Date;return"current"===U?s>=new Date(r.setDate(r.getDate()-r.getDay())):"previous"===U?s<new Date(r.setDate(r.getDate()-r.getDay()))&&s>=new Date(r.setDate(r.getDate()-7)):s<new Date(r.setDate(r.getDate()-7))})),H=E*P,O=H-P,W=B.slice(O,H),z=e=>F(e),K=Math.ceil(B.length/P),Q=Math.max(1,E-Math.floor(2.5)),V=Math.min(K,Q+5-1);return p?(0,u.jsx)("div",{className:"loading-container",children:(0,u.jsx)("div",{className:"spinner"})}):(0,u.jsxs)("div",{className:"audit-trail-page",style:{marginTop:"20px",padding:"20px"},children:[(0,u.jsx)(a.A,{className:"mb-4",children:(0,u.jsx)(n.A,{children:(0,u.jsx)("h2",{children:"Audit Trail"})})}),(0,u.jsx)(l.A,{className:"mb-4",children:(0,u.jsxs)(a.A,{className:"align-items-end",children:[(0,u.jsx)(n.A,{md:2,children:(0,u.jsxs)(l.A.Control,{as:"select",value:v.resourceType,onChange:e=>f({...v,resourceType:e.target.value}),children:[(0,u.jsx)("option",{value:"",children:"Resource Type"}),S.map((e=>(0,u.jsx)("option",{value:e,children:e},e)))]})}),(0,u.jsx)(n.A,{md:2,children:(0,u.jsxs)(l.A.Control,{as:"select",value:v.action,onChange:e=>f({...v,action:e.target.value}),children:[(0,u.jsx)("option",{value:"",children:"Action"}),T.map((e=>(0,u.jsx)("option",{value:e,children:e},e)))]})}),(0,u.jsx)(n.A,{md:2,children:(0,u.jsx)(x(),{selected:v.startDate,onChange:e=>f({...v,startDate:e}),placeholderText:"Start Date",className:"form-control"})}),(0,u.jsx)(n.A,{md:2,children:(0,u.jsx)(x(),{selected:v.endDate,onChange:e=>f({...v,endDate:e}),placeholderText:"End Date",className:"form-control"})}),(0,u.jsx)(n.A,{md:2,children:(0,u.jsxs)(i.A,{variant:"primary",onClick:async()=>{A(!0),D(null);try{const e=(await j.A.post("/audit_trail/filter",v)).data||[];h(e),M(e),F(1)}catch(y){console.error("Error filtering audit logs:",y),D("Failed to filter audit logs. Please try again later."),s("danger","Failed to filter audit logs. Please try again later.","Error")}finally{A(!1)}},children:[(0,u.jsx)(o.KSO,{})," Filter"]})})]})}),y&&(0,u.jsx)("p",{className:"text-center text-danger",children:y}),(0,u.jsx)(a.A,{className:"mb-4",children:(0,u.jsxs)(n.A,{children:[(0,u.jsx)(i.A,{variant:"current"===U?"primary":"secondary",onClick:()=>R("current"),children:"Current Week"})," ",(0,u.jsx)(i.A,{variant:"previous"===U?"primary":"secondary",onClick:()=>R("previous"),children:"Previous Week"})," ",(0,u.jsx)(i.A,{variant:"older"===U?"primary":"secondary",onClick:()=>R("older"),children:"Older"})]})}),(0,u.jsxs)(c.A,{striped:!0,bordered:!0,hover:!0,responsive:!0,children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{children:"#"}),(0,u.jsx)("th",{children:"Resource Type"}),(0,u.jsx)("th",{children:"Action"}),(0,u.jsx)("th",{children:"User"}),(0,u.jsx)("th",{children:"Resource ID"}),(0,u.jsx)("th",{children:"Details"}),(0,u.jsx)("th",{children:"Date"}),(0,u.jsx)("th",{children:"Actions"})]})}),(0,u.jsx)("tbody",{children:W.length>0?W.map(((e,r)=>(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{children:O+r+1}),(0,u.jsx)("td",{children:e.resource_type}),(0,u.jsx)("td",{children:e.action.replace("AuditAction.","")}),(0,u.jsx)("td",{children:g[e.user_id]||"Unknown User"}),(0,u.jsx)("td",{children:e.resource_id||"N/A"}),(0,u.jsx)("td",{children:e.details}),(0,u.jsx)("td",{children:new Date(e.timestamp).toLocaleString()}),(0,u.jsx)("td",{children:(0,u.jsxs)(i.A,{variant:"link",size:"sm",onClick:()=>(async e=>{A(!0),D(null);try{const s=await j.A.get(`/audit_trail/${e}`);w(s.data),k(!0)}catch(y){console.error("Error fetching log details:",y),s("danger","Failed to fetch log details. Please try again later.","Error")}finally{A(!1)}})(e.id),children:[(0,u.jsx)(o.__w,{})," Details"]})})]},e.id))):(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:"8",className:"text-center",children:"No audit logs found"})})})]}),(0,u.jsx)(a.A,{className:"mt-3",children:(0,u.jsxs)(n.A,{className:"text-center",children:[E>1&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(i.A,{variant:"secondary",onClick:()=>z(1),className:"mx-1",children:(0,u.jsx)(o.X8f,{})}),(0,u.jsx)(i.A,{variant:"secondary",onClick:()=>z(E-1),className:"mx-1",children:(0,u.jsx)(o.QVr,{})})]}),[...Array(V-Q+1).keys()].map((e=>(0,u.jsx)(i.A,{variant:E===Q+e?"primary":"secondary",onClick:()=>z(Q+e),className:"mx-1",children:Q+e},Q+e))),E<K&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(i.A,{variant:"secondary",onClick:()=>z(E+1),className:"mx-1",children:(0,u.jsx)(o.Z0P,{})}),(0,u.jsx)(i.A,{variant:"secondary",onClick:()=>z(K),className:"mx-1",children:(0,u.jsx)(o.eaw,{})})]})]})}),(0,u.jsxs)(d.A,{show:N,onHide:()=>k(!1),centered:!0,children:[(0,u.jsx)(d.A.Header,{closeButton:!0,children:(0,u.jsx)(d.A.Title,{children:"Audit Log Details"})}),(0,u.jsx)(d.A.Body,{children:C?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"ID:"})," ",C.id]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Resource Type:"})," ",C.resource_type]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Action:"})," ",C.action.replace("AuditAction.","")]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"User:"})," ",g[C.user_id]||"Unknown User"]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Resource ID:"})," ",C.resource_id||"N/A"]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Date:"})," ",new Date(C.timestamp).toLocaleString()]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Details:"})," ",C.details]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"IP Address:"})," ",C.ip_address||"N/A"]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"User Agent:"})," ",C.user_agent||"N/A"]})]}):(0,u.jsx)("p",{children:"No details available."})}),(0,u.jsx)(d.A.Footer,{children:(0,u.jsx)(i.A,{variant:"secondary",onClick:()=>k(!1),children:"Close"})})]})]})}}}]);
//# sourceMappingURL=893.aa5ca300.chunk.js.map