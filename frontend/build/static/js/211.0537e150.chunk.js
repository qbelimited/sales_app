"use strict";(self.webpackChunkSales_tracking_app=self.webpackChunkSales_tracking_app||[]).push([[211],{5211:(e,a,t)=>{t.r(a),t.d(a,{default:()=>A});var r=t(5043),s=t(8258),n=t(3814),l=t(1072),o=t(8602),i=t(4282),d=t(7417),c=t(4196),h=t(9621),p=t(2378),x=t(461),g=t(6058),j=t(1430),m=t(7762),b=t(557),u=t.n(b),f=t(6579),_=t(7929),y=t(579);x.t1.register(...x.$L);const v=["sale_manager_name","sales_executive_name","sales_executive_branch","product_name","product_category","product_group","bank_name","bank_branch_name","paypoint_name","source_type","collection_platform","status","customer_called","momo_first_premium"],A=e=>{let{showToast:a}=e;const[t,x]=(0,r.useState)({startDate:"",endDate:"",aggregateBy:""}),[b,A]=(0,r.useState)([]),[C,D]=(0,r.useState)(!1),[S,w]=(0,r.useState)({labels:[],datasets:[]}),[k,N]=(0,r.useState)("bar"),F=(0,r.useRef)(null),z=e=>{const{name:a,value:t}=e.target;x((e=>({...e,[a]:t})))},B=e=>{if(!e||0===e.length)return{labels:[],datasets:[]};const a=["rgba(255, 99, 132, 0.5)","rgba(54, 162, 235, 0.5)","rgba(255, 206, 86, 0.5)","rgba(75, 192, 192, 0.5)","rgba(153, 102, 255, 0.5)","rgba(255, 159, 64, 0.5)"];return{labels:e.map((e=>e.client_name||"Unknown")),datasets:[{label:"Amount",data:e.map((e=>parseFloat(e.amount)||0)),backgroundColor:a.slice(0,e.length),borderColor:a.slice(0,e.length).map((e=>e.replace("0.5","1"))),borderWidth:1}]}};return(0,y.jsxs)("div",{className:"container mt-5",children:[(0,y.jsx)("h2",{className:"text-center mb-4",children:"Generate Reports"}),(0,y.jsx)(s.A,{className:"mb-4",children:(0,y.jsx)(s.A.Body,{children:(0,y.jsx)(n.A,{children:(0,y.jsxs)(l.A,{children:[(0,y.jsx)(o.A,{xs:12,md:4,children:(0,y.jsxs)(n.A.Group,{controlId:"filterStartDate",children:[(0,y.jsx)(n.A.Label,{children:"Start Date"}),(0,y.jsx)(n.A.Control,{type:"date",name:"startDate",onChange:z})]})}),(0,y.jsx)(o.A,{xs:12,md:4,children:(0,y.jsxs)(n.A.Group,{controlId:"filterEndDate",children:[(0,y.jsx)(n.A.Label,{children:"End Date"}),(0,y.jsx)(n.A.Control,{type:"date",name:"endDate",onChange:z})]})}),(0,y.jsx)(o.A,{xs:12,md:4,children:(0,y.jsxs)(n.A.Group,{controlId:"aggregateBy",children:[(0,y.jsx)(n.A.Label,{children:"Aggregate By"}),(0,y.jsxs)(n.A.Control,{as:"select",name:"aggregateBy",onChange:z,children:[(0,y.jsx)("option",{value:"",children:"Select Aggregate Field"}),(0,y.jsx)("option",{value:"none",children:"None"}),v.map((e=>(0,y.jsx)("option",{value:e,children:e.replace(/_/g," ")},e)))]})]})}),(0,y.jsx)(o.A,{xs:12,className:"align-self-end mt-2",children:(0,y.jsx)(i.A,{variant:"primary",onClick:async()=>{if(t.startDate&&t.endDate)if(new Date(t.startDate)>new Date(t.endDate))a("warning","End date must be later than start date.","Warning");else{D(!0);try{const e=await h.A.post("/reports/sales",{filters:{start_date:t.startDate,end_date:t.endDate},aggregate_by:t.aggregateBy||"None"},{params:{sort_order:"desc",sort_by:"created_at",per_page:10,page:1}}),r=j.swJ(e.data);r&&r.length>0?(A(r),w(B(r))):(a("info","No data found for the selected filters.","Info"),A([]))}catch(e){console.error("Error fetching report data:",e),a("danger","Failed to fetch report data.","Error")}finally{D(!1)}}else a("warning","Please fill in all required fields.","Warning")},disabled:C,children:C?(0,y.jsx)(d.A,{animation:"border",size:"sm"}):"Preview"})})]})})})}),(0,y.jsx)(s.A,{className:"mt-4",children:(0,y.jsxs)(s.A.Body,{children:[(0,y.jsxs)(n.A.Group,{controlId:"chartType",children:[(0,y.jsx)(n.A.Label,{children:"Select Chart Type"}),(0,y.jsxs)(n.A.Control,{as:"select",size:"sm",value:k,onChange:e=>N(e.target.value),children:[(0,y.jsxs)("option",{value:"bar",children:[(0,y.jsx)(f.g,{icon:_.$Fj})," Bar Chart"]}),(0,y.jsxs)("option",{value:"line",children:[(0,y.jsx)(f.g,{icon:_.gK3})," Line Chart"]}),(0,y.jsxs)("option",{value:"pie",children:[(0,y.jsx)(f.g,{icon:_.W1p})," Pie Chart"]})]})]}),(0,y.jsxs)("div",{style:{position:"relative",height:"400px"},children:["bar"===k&&(0,y.jsx)(g.yP,{ref:F,data:S,options:{responsive:!0}}),"line"===k&&(0,y.jsx)(g.N1,{ref:F,data:S,options:{responsive:!0}}),"pie"===k&&(0,y.jsx)(g.Fq,{ref:F,data:S,options:{responsive:!0}})]})]})}),(0,y.jsx)("div",{className:"mt-4",children:b.length>0?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{className:"d-flex justify-content-between mb-3",children:[(0,y.jsx)(p.CSVLink,{data:b,filename:"report_preview.csv",children:(0,y.jsxs)(i.A,{variant:"success",children:[(0,y.jsx)(f.g,{icon:_.Wxp})," Download CSV"]})}),(0,y.jsxs)(i.A,{variant:"primary",onClick:()=>{const e=new m.default("landscape");e.setFontSize(22),e.text("Sales Report",14,20),e.setFontSize(12),e.text(`Report Date: ${(new Date).toLocaleDateString()}`,14,30),e.text(`Date Range: ${t.startDate} to ${t.endDate}`,14,40),e.setFontSize(10);const a=Object.keys(b[0]).map((e=>({header:e,dataKey:e,width:30})));u()(e,{head:[a],body:b.map((e=>Object.keys(e).map((a=>e[a])))),startY:50,margin:{horizontal:10},styles:{fontSize:8,cellPadding:2,overflow:"linebreak",lineWidth:.5,lineColor:[44,62,80],fillColor:[244,244,244]},headStyles:{fillColor:[52,152,219],textColor:[255,255,255],fontSize:9,fontStyle:"bold"},alternateRowStyles:{fillColor:[220,220,220]},theme:"striped",pageBreak:"avoid"}),e.save("sales_report.pdf")},disabled:C,children:[C?(0,y.jsx)(d.A,{animation:"border",size:"sm"}):(0,y.jsx)(f.g,{icon:_.O_q})," Download PDF"]})]}),(0,y.jsxs)(c.A,{id:"reportTable",striped:!0,bordered:!0,hover:!0,responsive:!0,children:[(0,y.jsx)("thead",{children:(0,y.jsx)("tr",{children:Object.keys(b[0]).map((e=>(0,y.jsx)("th",{children:e.replace(/_/g," ")},e)))})}),(0,y.jsx)("tbody",{children:b.map(((e,a)=>(0,y.jsx)("tr",{children:Object.values(e).map(((e,a)=>(0,y.jsx)("td",{children:e},a)))},a)))})]})]}):(0,y.jsx)("p",{children:"No report data available."})})]})}}}]);
//# sourceMappingURL=211.0537e150.chunk.js.map