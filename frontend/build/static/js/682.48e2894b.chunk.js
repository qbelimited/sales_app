"use strict";(self.webpackChunkSales_tracking_app=self.webpackChunkSales_tracking_app||[]).push([[682],{5682:(e,r,a)=>{a.r(r),a.d(r,{default:()=>p});var t=a(5043),s=a(7417),n=a(1072),l=a(8602),i=a(3814),c=a(4282),o=a(4196),d=a(2725),u=a(6579),h=a(7929),m=a(9621),x=a(579);const p=e=>{let{showToast:r}=e;const[a,p]=(0,t.useState)([]),[j,g]=(0,t.useState)([]),[f,A]=(0,t.useState)(!0),[_,y]=(0,t.useState)(null),[v,C]=(0,t.useState)(null),[S,b]=(0,t.useState)(!1),[P,w]=(0,t.useState)(!1),[D,T]=(0,t.useState)(!1),[$,k]=(0,t.useState)(!1),[E,I]=(0,t.useState)(null),[N,F]=(0,t.useState)(1),[L,M]=(0,t.useState)(1),[V]=(0,t.useState)(10),[G,q]=(0,t.useState)(""),[B,H]=(0,t.useState)(""),[R,U]=(0,t.useState)(""),z=(0,t.useCallback)((async()=>{try{const e=await m.A.get("/dropdown/",{params:{type:"users_with_roles",role_id:4}});g(e.data)}catch(_){console.error("Failed to fetch sales managers:",_)}}),[]),J=(0,t.useCallback)((async()=>{A(!0),y(null);try{const e=await m.A.get("/sales_performance/",{params:{per_page:V,page:N,criteria_type:G,criteria_value:B,target_id:R}}),a=e.data.sales_performances,t=[...new Set(a.map((e=>e.target_id)))].map((async e=>{try{return(await m.A.get(`/sales_target/${e}`)).data}catch(_){return console.error("Failed to fetch target details:",_),r("danger","Failed to fetch target details.","Error"),null}})),s=(await Promise.all(t)).reduce(((e,r)=>(r&&(e[r.id]=r),e)),{});return p(a),M(Math.ceil(e.data.total/V)),s}catch(t){var e,a;console.error("Error fetching sales performance:",t);const s=(null===(e=t.response)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.message)||"Failed to load sales performance data.";y(s),r("danger",s,"Error")}finally{A(!1)}}),[r,N,V,G,B,R]);(0,t.useEffect)((()=>{z();(async()=>{const e=await J();I(e)})()}),[z,J]);const Q=()=>{b(!1)},W=()=>{C(null),w(!1)},K=()=>{C(null),T(!1)},O=()=>{k(!1),I(null)},X=e=>{e.preventDefault();const a=new FormData(e.target),t={sales_manager_id:a.get("sales_manager_id"),actual_sales_count:0,actual_premium_amount:0,target_id:a.get("target_id"),criteria_type:a.get("criteria_type"),criteria_value:a.get("criteria_value"),criteria_met_count:0,performance_date:a.get("performance_date")};v?(async e=>{try{await m.A.put(`/sales_performance/${v.id}`,e),r("success","Performance updated successfully.","Success"),J(),W()}catch(a){console.error("Error updating performance:",a),r("danger","Failed to update performance.","Error")}})(t):(async e=>{try{await m.A.post("/sales_performance/",e),r("success","Performance created successfully.","Success"),J(),Q()}catch(a){console.error("Error adding performance:",a),r("danger","Failed to save performance.","Error")}})(t)},Y=a.map((e=>{const r=null===E||void 0===E?void 0:E[e.target_id],a=(null===r||void 0===r?void 0:r.target_sales_count)||1,t=(null===r||void 0===r?void 0:r.target_premium_amount)||1,s=r?((e,r)=>{const a=new Date(e),t=new Date(r);let s=0;for(;a<=t;){const e=a.getDay();0!==e&&6!==e&&s++,a.setDate(a.getDate()+1)}return s})(r.period_start,r.period_end):1;return{...e,salesCountPercentage:(e.actual_sales_count/a*100).toFixed(2),premiumAmountPercentage:(e.actual_premium_amount/t*100).toFixed(2),criteriaMetCountPercentage:(e.criteria_met_count/s*100).toFixed(2)}}));return(0,x.jsxs)("div",{className:"container mt-5",children:[(0,x.jsx)("h1",{className:"text-center mb-4",children:"Sales Performance"}),f&&(0,x.jsx)(s.A,{animation:"border",variant:"primary"}),_&&(0,x.jsx)("p",{className:"text-danger",children:_}),(0,x.jsxs)(n.A,{className:"mb-3",children:[(0,x.jsx)(l.A,{xs:12,md:3,children:(0,x.jsx)(i.A.Control,{type:"text",placeholder:"Criteria Type",value:G,onChange:e=>q(e.target.value)})}),(0,x.jsx)(l.A,{xs:12,md:3,children:(0,x.jsx)(i.A.Control,{type:"text",placeholder:"Criteria Value",value:B,onChange:e=>H(e.target.value)})}),(0,x.jsx)(l.A,{xs:12,md:3,children:(0,x.jsx)(i.A.Control,{type:"text",placeholder:"Target ID",value:R,onChange:e=>U(e.target.value)})}),(0,x.jsx)(l.A,{xs:12,md:3,children:(0,x.jsx)(c.A,{variant:"primary",onClick:e=>{e.preventDefault(),F(1),J()},children:"Filter"})})]}),(0,x.jsxs)(c.A,{variant:"primary",onClick:()=>{C(null),b(!0)},className:"mb-3",children:[(0,x.jsx)(u.g,{icon:h.QLR})," Add Performance"]}),(0,x.jsx)(c.A,{variant:"success",onClick:async()=>{try{await m.A.post("/sales_performance/auto-generate"),r("success","Performance records generated successfully.","Success"),J()}catch(e){console.error("Error generating performance records:",e),r("danger","Failed to generate performance records.","Error")}},className:"mb-3 ml-2",children:"Generate Past Performances"}),(0,x.jsx)(c.A,{variant:"info",onClick:async()=>{try{await m.A.post("/sales_performance/auto-update"),r("success","Performance records updated successfully.","Success"),J()}catch(e){console.error("Error updating performance records:",e),r("danger","Failed to update performance records.","Error")}},className:"mb-3 ml-2",children:"Update Performances"}),(0,x.jsxs)(o.A,{striped:!0,bordered:!0,hover:!0,responsive:!0,className:"mt-3",children:[(0,x.jsx)("thead",{children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{children:"ID"}),(0,x.jsx)("th",{children:"Sales Manager"}),(0,x.jsx)("th",{children:"Actual Sales Count"}),(0,x.jsx)("th",{children:"% Sales Count"}),(0,x.jsx)("th",{children:"Actual Premium Amount"}),(0,x.jsx)("th",{children:"% Premium Amount"}),(0,x.jsx)("th",{children:"Target"}),(0,x.jsx)("th",{children:"Criteria Type"}),(0,x.jsx)("th",{children:"Criteria Value"}),(0,x.jsx)("th",{children:"Criteria Met Count"}),(0,x.jsx)("th",{children:"% Criteria Met Count"}),(0,x.jsx)("th",{children:"Performance Date"}),(0,x.jsx)("th",{children:"Actions"})]})}),(0,x.jsx)("tbody",{children:Y.map((e=>{var a;return(0,x.jsxs)("tr",{children:[(0,x.jsx)("td",{children:e.id}),(0,x.jsx)("td",{children:null===(a=j.find((r=>r.id===e.sales_manager_id)))||void 0===a?void 0:a.name}),(0,x.jsx)("td",{children:e.actual_sales_count}),(0,x.jsxs)("td",{children:[e.salesCountPercentage,"%"]}),(0,x.jsx)("td",{children:e.actual_premium_amount}),(0,x.jsxs)("td",{children:[e.premiumAmountPercentage,"%"]}),(0,x.jsx)("td",{children:(0,x.jsxs)(c.A,{variant:"link",onClick:()=>(e=>{const a=null===E||void 0===E?void 0:E[e];a?(I(a),k(!0)):(console.error("Target not found for ID:",e),r("danger","Target details not found.","Error"))})(e.target_id),children:[e.target_id," ",(0,x.jsx)(u.g,{icon:h.iW_})]})}),(0,x.jsx)("td",{children:e.criteria_type}),(0,x.jsx)("td",{children:e.criteria_value}),(0,x.jsx)("td",{children:e.criteria_met_count}),(0,x.jsxs)("td",{children:[e.criteriaMetCountPercentage,"%"]}),(0,x.jsx)("td",{children:new Date(e.performance_date).toLocaleDateString()}),(0,x.jsxs)("td",{children:[(0,x.jsxs)(c.A,{variant:"warning",onClick:()=>(e=>{C(e),w(!0)})(e),children:[(0,x.jsx)(u.g,{icon:h.MT7})," Edit"]}),(0,x.jsxs)(c.A,{variant:"danger",onClick:()=>(e=>{C(e),T(!0)})(e),children:[(0,x.jsx)(u.g,{icon:h.BeE})," Delete"]})]})]},e.id)}))})]}),(0,x.jsxs)("div",{className:"d-flex justify-content-center mt-4",children:[(0,x.jsx)(c.A,{variant:"secondary",onClick:()=>{N>1&&F((e=>e-1))},disabled:1===N,children:"Previous"}),(0,x.jsx)("span",{className:"mx-2",children:`Page ${N} of ${L}`}),(0,x.jsx)(c.A,{variant:"secondary",onClick:()=>{N<L&&F((e=>e+1))},disabled:N===L,children:"Next"})]}),(0,x.jsxs)(d.A,{show:S,onHide:Q,children:[(0,x.jsx)(d.A.Header,{closeButton:!0,children:(0,x.jsx)(d.A.Title,{children:"Add Performance"})}),(0,x.jsx)(d.A.Body,{children:(0,x.jsxs)(i.A,{onSubmit:X,children:[(0,x.jsxs)(i.A.Group,{controlId:"formSalesManager",children:[(0,x.jsx)(i.A.Label,{children:"Sales Manager"}),(0,x.jsxs)(i.A.Control,{as:"select",name:"sales_manager_id",required:!0,children:[(0,x.jsx)("option",{value:"",children:"Select Sales Manager"}),j.map((e=>(0,x.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,x.jsxs)(i.A.Group,{controlId:"formTargetId",children:[(0,x.jsx)(i.A.Label,{children:"Target ID"}),(0,x.jsx)(i.A.Control,{type:"text",name:"target_id",required:!0})]}),(0,x.jsxs)(i.A.Group,{controlId:"formCriteriaType",children:[(0,x.jsx)(i.A.Label,{children:"Criteria Type"}),(0,x.jsx)(i.A.Control,{type:"text",name:"criteria_type",required:!0})]}),(0,x.jsxs)(i.A.Group,{controlId:"formCriteriaValue",children:[(0,x.jsx)(i.A.Label,{children:"Criteria Value"}),(0,x.jsx)(i.A.Control,{type:"text",name:"criteria_value",required:!0})]}),(0,x.jsxs)(i.A.Group,{controlId:"formPerformanceDate",children:[(0,x.jsx)(i.A.Label,{children:"Performance Date"}),(0,x.jsx)(i.A.Control,{type:"datetime-local",name:"performance_date",required:!0})]}),(0,x.jsx)(c.A,{variant:"primary",type:"submit",children:"Create"})]})})]}),(0,x.jsxs)(d.A,{show:P,onHide:W,children:[(0,x.jsx)(d.A.Header,{closeButton:!0,children:(0,x.jsx)(d.A.Title,{children:"Edit Performance"})}),(0,x.jsx)(d.A.Body,{children:v&&(0,x.jsxs)(i.A,{onSubmit:X,children:[(0,x.jsxs)(i.A.Group,{controlId:"formSalesManager",children:[(0,x.jsx)(i.A.Label,{children:"Sales Manager"}),(0,x.jsxs)(i.A.Control,{as:"select",name:"sales_manager_id",defaultValue:v.sales_manager_id,required:!0,children:[(0,x.jsx)("option",{value:"",children:"Select Sales Manager"}),j.map((e=>(0,x.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,x.jsxs)(i.A.Group,{controlId:"formTargetId",children:[(0,x.jsx)(i.A.Label,{children:"Target ID"}),(0,x.jsx)(i.A.Control,{type:"text",name:"target_id",defaultValue:v.target_id,required:!0})]}),(0,x.jsxs)(i.A.Group,{controlId:"formCriteriaType",children:[(0,x.jsx)(i.A.Label,{children:"Criteria Type"}),(0,x.jsx)(i.A.Control,{type:"text",name:"criteria_type",defaultValue:v.criteria_type,required:!0})]}),(0,x.jsxs)(i.A.Group,{controlId:"formCriteriaValue",children:[(0,x.jsx)(i.A.Label,{children:"Criteria Value"}),(0,x.jsx)(i.A.Control,{type:"text",name:"criteria_value",defaultValue:v.criteria_value,required:!0})]}),(0,x.jsxs)(i.A.Group,{controlId:"formPerformanceDate",children:[(0,x.jsx)(i.A.Label,{children:"Performance Date"}),(0,x.jsx)(i.A.Control,{type:"datetime-local",name:"performance_date",defaultValue:v.performance_date.slice(0,16),required:!0})]}),(0,x.jsx)(c.A,{variant:"primary",type:"submit",children:"Update"})]})})]}),(0,x.jsxs)(d.A,{show:D,onHide:K,children:[(0,x.jsx)(d.A.Header,{closeButton:!0,children:(0,x.jsx)(d.A.Title,{children:"Confirm Deletion"})}),(0,x.jsx)(d.A.Body,{children:(0,x.jsx)("p",{children:"Are you sure you want to delete this performance record? This action cannot be undone."})}),(0,x.jsxs)(d.A.Footer,{children:[(0,x.jsx)(c.A,{variant:"secondary",onClick:K,children:"Cancel"}),(0,x.jsx)(c.A,{variant:"danger",onClick:async()=>{try{await m.A.delete(`/sales_performance/${v.id}`),r("success","Performance deleted successfully.","Success"),J(),K()}catch(e){console.error("Error deleting performance:",e),r("danger","Failed to delete performance.","Error")}},children:"Delete"})]})]}),(0,x.jsxs)(d.A,{show:$,onHide:O,children:[(0,x.jsx)(d.A.Header,{closeButton:!0,children:(0,x.jsx)(d.A.Title,{children:"Target Details"})}),(0,x.jsx)(d.A.Body,{children:E&&(0,x.jsxs)("div",{children:[(0,x.jsxs)("p",{children:[(0,x.jsx)("strong",{children:"ID:"})," ",E.id]}),(0,x.jsxs)("p",{children:[(0,x.jsx)("strong",{children:"Target Sales Count:"})," ",E.target_sales_count]}),(0,x.jsxs)("p",{children:[(0,x.jsx)("strong",{children:"Target Premium Amount:"})," ",E.target_premium_amount]}),(0,x.jsxs)("p",{children:[(0,x.jsx)("strong",{children:"Criteria Type:"})," ",E.target_criteria_type]}),(0,x.jsxs)("p",{children:[(0,x.jsx)("strong",{children:"Criteria Value:"})," ",E.target_criteria_value]}),(0,x.jsxs)("p",{children:[(0,x.jsx)("strong",{children:"Period Start:"})," ",new Date(E.period_start).toLocaleDateString()]}),(0,x.jsxs)("p",{children:[(0,x.jsx)("strong",{children:"Period End:"})," ",new Date(E.period_end).toLocaleDateString()]})]})}),(0,x.jsx)(d.A.Footer,{children:(0,x.jsx)(c.A,{variant:"secondary",onClick:O,children:"Close"})})]})]})}},1072:(e,r,a)=>{a.d(r,{A:()=>o});var t=a(8139),s=a.n(t),n=a(5043),l=a(7852),i=a(579);const c=n.forwardRef(((e,r)=>{let{bsPrefix:a,className:t,as:n="div",...c}=e;const o=(0,l.oU)(a,"row"),d=(0,l.gy)(),u=(0,l.Jm)(),h=`${o}-cols`,m=[];return d.forEach((e=>{const r=c[e];let a;delete c[e],null!=r&&"object"===typeof r?({cols:a}=r):a=r;const t=e!==u?`-${e}`:"";null!=a&&m.push(`${h}${t}-${a}`)})),(0,i.jsx)(n,{ref:r,...c,className:s()(t,o,...m)})}));c.displayName="Row";const o=c},4196:(e,r,a)=>{a.d(r,{A:()=>c});var t=a(8139),s=a.n(t),n=a(5043),l=a(7852),i=a(579);const c=n.forwardRef(((e,r)=>{let{bsPrefix:a,className:t,striped:n,bordered:c,borderless:o,hover:d,size:u,variant:h,responsive:m,...x}=e;const p=(0,l.oU)(a,"table"),j=s()(t,p,h&&`${p}-${h}`,u&&`${p}-${u}`,n&&`${p}-${"string"===typeof n?`striped-${n}`:"striped"}`,c&&`${p}-bordered`,o&&`${p}-borderless`,d&&`${p}-hover`),g=(0,i.jsx)("table",{...x,className:j,ref:r});if(m){let e=`${p}-responsive`;return"string"===typeof m&&(e=`${e}-${m}`),(0,i.jsx)("div",{className:e,children:g})}return g}))}}]);
//# sourceMappingURL=682.48e2894b.chunk.js.map