"use strict";(self.webpackChunkSales_tracking_app=self.webpackChunkSales_tracking_app||[]).push([[274],{1274:(e,s,n)=>{n.r(s),n.d(s,{default:()=>h});var t=n(5043),i=n(9621),r=n(4107),l=n(2725),o=n(4282),c=n(579);const d=e=>{let{showToast:s,onEndSession:n}=e;const{sessions:i,loading:d,error:a}=(0,r.Jd)(),[h,u]=(0,t.useState)(null),[x,j]=(0,t.useState)(!1),[m,g]=(0,t.useState)(null),[_,v]=(0,t.useState)({});if(d)return(0,c.jsx)("p",{"aria-live":"polite",children:"Loading sessions..."});if(a)return(0,c.jsx)("p",{className:"text-danger",role:"alert",children:"Failed to load sessions."});const b=Array.from(new Set(i.map((e=>e.user_id)))).map((e=>i.find((s=>s.user_id===e)))).sort(((e,s)=>{const n=i.filter((s=>s.user_id===e.user_id&&s.is_active)).length;return i.filter((e=>e.user_id===s.user_id&&e.is_active)).length-n})),S=function(e){let s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return i.filter((n=>n.user_id===e&&n.is_active===s))},f=(e,s)=>{if(s){const n=(new Date(s)-new Date(e))/1e3;return`${Math.floor(n/3600)} hours, ${Math.floor(n%3600/60)} minutes, ${Math.floor(n%60)} seconds`}return"Active"};return(0,c.jsxs)("div",{children:[h?(0,c.jsxs)("div",{children:[(0,c.jsx)("button",{className:"btn btn-secondary mb-3",onClick:()=>u(null),children:"Back to All Users"}),(0,c.jsxs)("table",{className:"table table-striped",role:"table",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{children:"Session ID"}),(0,c.jsx)("th",{children:"User Name"}),(0,c.jsx)("th",{children:"Login Time"}),(0,c.jsx)("th",{children:"Logout Time"}),(0,c.jsx)("th",{children:"Session Duration"}),(0,c.jsx)("th",{children:"IP Address"}),(0,c.jsx)("th",{children:"Status"}),(0,c.jsx)("th",{children:"Actions"})]})}),(0,c.jsxs)("tbody",{children:[S(h).map((e=>(0,c.jsxs)("tr",{role:"row",children:[(0,c.jsx)("td",{children:e.id}),(0,c.jsx)("td",{children:e.user_name}),(0,c.jsx)("td",{children:new Date(e.login_time).toLocaleString()}),(0,c.jsx)("td",{children:e.logout_time?new Date(e.logout_time).toLocaleString():"Active"}),(0,c.jsx)("td",{children:f(e.login_time,e.logout_time)}),(0,c.jsx)("td",{children:e.ip_address}),(0,c.jsx)("td",{children:e.is_active?"Active":"Inactive"}),(0,c.jsx)("td",{children:e.is_active&&(0,c.jsx)("button",{className:"btn btn-danger btn-sm",onClick:()=>{return s=e.id,n=e.user_id,g({sessionId:s,userId:n}),void j(!0);var s,n},children:"End Session"})})]},e.id))),_[h]&&S(h,!1).map((e=>(0,c.jsxs)("tr",{className:"table-secondary",role:"row",children:[(0,c.jsx)("td",{children:e.id}),(0,c.jsx)("td",{children:e.user_name}),(0,c.jsx)("td",{children:new Date(e.login_time).toLocaleString()}),(0,c.jsx)("td",{children:e.logout_time?new Date(e.logout_time).toLocaleString():"Active"}),(0,c.jsx)("td",{children:f(e.login_time,e.logout_time)}),(0,c.jsx)("td",{children:e.ip_address}),(0,c.jsx)("td",{children:e.is_active?"Active":"Inactive"}),(0,c.jsx)("td",{children:"N/A"})]},e.id)))]})]}),(0,c.jsx)("button",{className:"btn btn-info btn-sm",onClick:()=>{return e=h,void v((s=>({...s,[e]:!s[e]})));var e},children:_[h]?"Hide Inactive Sessions":"Show Inactive Sessions"})]}):(0,c.jsxs)("table",{className:"table table-striped",role:"table",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{children:"User Name"}),(0,c.jsx)("th",{children:"Active Sessions Count"}),(0,c.jsx)("th",{children:"Actions"})]})}),(0,c.jsx)("tbody",{children:b.length>0?b.map((e=>(0,c.jsxs)("tr",{role:"row",children:[(0,c.jsx)("td",{children:e.user_name}),(0,c.jsx)("td",{children:S(e.user_id).length}),(0,c.jsx)("td",{children:(0,c.jsx)("button",{className:"btn btn-info btn-sm",onClick:()=>u(e.user_id),children:"View All Sessions"})})]},e.user_id))):(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:"3",children:"No users with active sessions found."})})})]}),(0,c.jsxs)(l.A,{show:x,onHide:()=>j(!1),children:[(0,c.jsx)(l.A.Header,{closeButton:!0,children:(0,c.jsx)(l.A.Title,{children:"Confirm Deletion"})}),(0,c.jsx)(l.A.Body,{children:(0,c.jsx)("p",{children:"Are you sure you want to end this session? This action cannot be undone."})}),(0,c.jsxs)(l.A.Footer,{children:[(0,c.jsx)(o.A,{variant:"secondary",onClick:()=>j(!1),children:"Cancel"}),(0,c.jsx)(o.A,{variant:"danger",onClick:async()=>{m&&(await n(m.sessionId,m.userId),s("success","Session ended successfully.","Success"),j(!1),g(null))},children:"End Session"})]})]})]})};var a=n(2301);const h=e=>{let{showToast:s}=e;const[n,r]=(0,t.useState)([]),[l,o]=(0,t.useState)(!0),[h,u]=(0,t.useState)(null),x=(0,t.useCallback)((async()=>{o(!0),u(null);const e=setTimeout((()=>{s("warning","Fetching sessions is taking longer than expected.","Warning")}),5e3);try{const e=await i.A.get("/users/sessions");r(e.data.sessions)}catch(h){console.error("Error fetching sessions:",h),u("Failed to fetch user sessions."),s("danger","Failed to fetch user sessions.","Error")}finally{o(!1),clearTimeout(e)}}),[s]);(0,t.useEffect)((()=>{x()}),[x]);return(0,c.jsxs)("div",{className:"container mt-5",role:"main",children:[(0,c.jsx)("h1",{className:"text-center mb-4","aria-live":"polite",children:"Manage User Sessions"}),l?(0,c.jsx)(a.A,{}):n.length>0?(0,c.jsx)(d,{sessions:n,onEndSession:async(e,n)=>{try{await i.A.delete(`/users/${n}/sessions/${e}`),s("success","Session ended successfully.","Success"),x()}catch(h){console.error("Error ending session:",h),s("danger","Failed to end the session.","Error")}},showToast:s}):(0,c.jsx)("p",{className:"text-center","aria-live":"polite",children:"No active sessions available."}),h&&(0,c.jsx)("p",{className:"text-danger",role:"alert",children:h})," "]})}}}]);
//# sourceMappingURL=274.612dfaf2.chunk.js.map