"use strict";(self.webpackChunkSales_tracking_app=self.webpackChunkSales_tracking_app||[]).push([[189],{5189:(e,s,r)=>{r.r(s),r.d(s,{default:()=>p});var a=r(5043),t=r(7417),i=r(4282),n=r(5555),d=r(4196),l=r(2725),o=r(8258),c=r(7491),h=r(6579),u=r(7929),x=r(9621),m=r(3216),j=r(579);const p=e=>{let{showToast:s}=e;const[r,p]=(0,a.useState)([]),[y,v]=(0,a.useState)(!0),[f,g]=(0,a.useState)(!1),[N,b]=(0,a.useState)(!1),[_,A]=(0,a.useState)(null),[S,w]=(0,a.useState)(1),[C]=(0,a.useState)(10),[k,R]=(0,a.useState)({}),P=Math.ceil(r.length/C),I=JSON.parse(localStorage.getItem("user")),$=(0,m.Zp)(),E=(0,a.useCallback)((async()=>{v(!0);try{const e=await x.A.get("/under_investigation/");p(e.data.map((e=>({...e,notes_history:Array.isArray(e.notes_history)?e.notes_history:"string"===typeof e.notes_history?e.notes_history.split("\n"):[]}))));const s=(await x.A.get("/users/")).data.users.reduce(((e,s)=>(e[s.id]=s,e)),{});R(s)}catch(e){console.error("Error fetching investigation records:",e),s("error","Failed to fetch investigation records.","Error")}finally{v(!1)}}),[s]);(0,a.useEffect)((()=>{E()}),[E]);const U=()=>{g(!1),A(null)},D=S*C,F=D-C,H=r.slice(F,D),L=e=>{w(e)};return y?(0,j.jsx)(t.A,{animation:"border"}):(0,j.jsxs)("div",{children:[(0,j.jsx)("h2",{children:"Under Investigation Records"}),(0,j.jsx)(i.A,{variant:"primary",onClick:async()=>{try{const e=await x.A.post("/under_investigation/auto-update");s("success",e.data.message||"Records updated successfully.","Success"),E()}catch(e){console.error("Error during auto-update:",e),s("error","Failed to update records.","Error")}},className:"mb-3",children:"Run Auto Update"}),(0,j.jsxs)(n.A,{variant:"info",size:"lg",children:[(0,j.jsx)("strong",{children:"Legend:"}),(0,j.jsxs)("ul",{children:[(0,j.jsxs)("li",{children:[(0,j.jsx)("strong",{children:"Critical Duplicate Detected:"})," This indicates that there are multiple records that match certain critical conditions such as phone number, client ID, and policy type."]}),(0,j.jsxs)("li",{children:[(0,j.jsx)("strong",{children:"Potential Duplicate Detected:"})," This indicates that there might be possible duplicates based on client phone and policy type."]})]})]}),(0,j.jsxs)(d.A,{striped:!0,bordered:!0,hover:!0,responsive:!0,children:[(0,j.jsx)("thead",{children:(0,j.jsxs)("tr",{children:[(0,j.jsx)("th",{children:"ID"}),(0,j.jsx)("th",{children:"Sale ID"}),(0,j.jsx)("th",{children:"Reason"}),(0,j.jsx)("th",{children:"Notes"}),(0,j.jsx)("th",{children:"Flagged At"}),(0,j.jsx)("th",{children:"Resolved At"}),(0,j.jsx)("th",{children:"Updated By"}),(0,j.jsx)("th",{children:"Notes History"}),(0,j.jsx)("th",{children:"Actions"})]})}),(0,j.jsx)("tbody",{children:H.map((e=>{var r;return(0,j.jsxs)("tr",{children:[(0,j.jsx)("td",{children:e.id}),(0,j.jsx)("td",{children:e.sale_id}),(0,j.jsx)("td",{children:e.reason}),(0,j.jsx)("td",{children:e.notes}),(0,j.jsx)("td",{children:new Date(e.flagged_at).toLocaleString()}),(0,j.jsx)("td",{children:e.resolved_at?new Date(e.resolved_at).toLocaleString():"Not Resolved"}),(0,j.jsx)("td",{children:(null===(r=k[e.updated_by_user_id])||void 0===r?void 0:r.name)||"System"}),(0,j.jsx)("td",{children:(0,j.jsxs)(i.A,{variant:"info",onClick:()=>(e=>{A(e),b(!0)})(e),children:[(0,j.jsx)(h.g,{icon:u.Int})," View History"]})}),(0,j.jsxs)("td",{children:[(0,j.jsxs)(i.A,{variant:"primary",onClick:()=>{return s=e.sale_id,void $(`/sales/${s}`);var s},children:[(0,j.jsx)(h.g,{icon:u.pS3})," View Sale"]}),(0,j.jsxs)(i.A,{variant:"warning",onClick:()=>(e=>{A(e),g(!0)})(e),children:[(0,j.jsx)(h.g,{icon:u.MT7})," Edit"]}),(0,j.jsxs)(i.A,{variant:"danger",onClick:()=>(async e=>{try{await x.A.delete(`/under_investigation/${e}`),p((s=>s.filter((s=>s.id!==e)))),s("success","Record deleted successfully.","Success")}catch(r){console.error("Error deleting record:",r),s("error","Failed to delete record.","Error")}})(e.id),children:[(0,j.jsx)(h.g,{icon:u.yLS})," Delete"]}),(0,j.jsxs)(i.A,{variant:"success",onClick:()=>(async e=>{try{const r={resolved:!0,resolved_at:(new Date).toISOString()};await x.A.put(`/under_investigation/${e}`,r),p((s=>s.map((s=>s.id===e?{...s,...r}:s)))),s("success","Record marked as resolved.","Success")}catch(r){console.error("Error marking record as resolved:",r),s("error","Failed to mark record as resolved.","Error")}})(e.id),children:[(0,j.jsx)(h.g,{icon:u.e68})," Mark as Resolved"]})]})]},e.id)}))})]}),(0,j.jsx)(l.A,{show:f,onHide:U,children:(0,j.jsxs)(o.A,{style:{padding:"20px"},children:[(0,j.jsx)("h5",{children:"Edit Investigation Record"}),(0,j.jsxs)("form",{onSubmit:e=>{e.preventDefault(),(async e=>{try{const r={notes:_.notes,reason:_.reason,updated_by_name:I.name||"System",updated_by_email:I.email||"system",updated_at:(new Date).toISOString()},a=`${r.updated_at} - Reason: ${r.reason}: ${r.notes} - Updated by ${r.updated_by_name} (${r.updated_by_email})`,t={...e,notes_history:[..._.notes_history||[],a],updated_by_user_id:I.id};await x.A.put(`/under_investigation/${_.id}`,t),p((e=>e.map((e=>e.id===_.id?{...e,...t}:e)))),s("success","Record updated successfully.","Success"),U()}catch(r){console.error("Error updating record:",r),s("error","Failed to update record.","Error")}})({reason:_.reason,notes:_.notes})},children:[(0,j.jsxs)("div",{className:"mb-3",children:[(0,j.jsx)("label",{children:"Reason"}),(0,j.jsx)("input",{type:"text",className:"form-control",value:(null===_||void 0===_?void 0:_.reason)||"",onChange:e=>A({..._,reason:e.target.value})})]}),(0,j.jsxs)("div",{className:"mb-3",children:[(0,j.jsx)("label",{children:"Notes"}),(0,j.jsx)("input",{type:"text",className:"form-control",value:(null===_||void 0===_?void 0:_.notes)||"",onChange:e=>A({..._,notes:e.target.value})})]}),(0,j.jsx)(i.A,{type:"submit",children:"Save Changes"})]})]})}),(0,j.jsx)(l.A,{show:N,onHide:()=>{b(!1)},size:"lg",children:(0,j.jsxs)(o.A,{style:{padding:"20px",maxHeight:"70vh",overflowY:"scroll"},children:[(0,j.jsx)("h5",{children:"Notes History"}),(0,j.jsx)("ul",{children:Array.isArray(null===_||void 0===_?void 0:_.notes_history)&&_.notes_history.length>0?_.notes_history.map(((e,s)=>(0,j.jsx)("li",{children:e},s))):(0,j.jsx)("li",{children:"No history available"})})]})}),(0,j.jsxs)(c.A,{className:"justify-content-center mt-4",children:[(0,j.jsx)(c.A.First,{onClick:()=>L(1),disabled:1===S}),(0,j.jsx)(c.A.Prev,{onClick:()=>L(S-1),disabled:1===S}),[...Array(P)].map(((e,s)=>(0,j.jsx)(c.A.Item,{active:s+1===S,onClick:()=>L(s+1),children:s+1},s+1))),(0,j.jsx)(c.A.Next,{onClick:()=>L(S+1),disabled:S===P}),(0,j.jsx)(c.A.Last,{onClick:()=>L(P),disabled:S===P})]})]})}},8258:(e,s,r)=>{r.d(s,{A:()=>$});var a=r(8139),t=r.n(a),i=r(5043),n=r(7852),d=r(579);const l=i.forwardRef(((e,s)=>{let{className:r,bsPrefix:a,as:i="div",...l}=e;return a=(0,n.oU)(a,"card-body"),(0,d.jsx)(i,{ref:s,className:t()(r,a),...l})}));l.displayName="CardBody";const o=l,c=i.forwardRef(((e,s)=>{let{className:r,bsPrefix:a,as:i="div",...l}=e;return a=(0,n.oU)(a,"card-footer"),(0,d.jsx)(i,{ref:s,className:t()(r,a),...l})}));c.displayName="CardFooter";const h=c,u=i.createContext(null);u.displayName="CardHeaderContext";const x=u,m=i.forwardRef(((e,s)=>{let{bsPrefix:r,className:a,as:l="div",...o}=e;const c=(0,n.oU)(r,"card-header"),h=(0,i.useMemo)((()=>({cardHeaderBsPrefix:c})),[c]);return(0,d.jsx)(x.Provider,{value:h,children:(0,d.jsx)(l,{ref:s,...o,className:t()(a,c)})})}));m.displayName="CardHeader";const j=m,p=i.forwardRef(((e,s)=>{let{bsPrefix:r,className:a,variant:i,as:l="img",...o}=e;const c=(0,n.oU)(r,"card-img");return(0,d.jsx)(l,{ref:s,className:t()(i?`${c}-${i}`:c,a),...o})}));p.displayName="CardImg";const y=p,v=i.forwardRef(((e,s)=>{let{className:r,bsPrefix:a,as:i="div",...l}=e;return a=(0,n.oU)(a,"card-img-overlay"),(0,d.jsx)(i,{ref:s,className:t()(r,a),...l})}));v.displayName="CardImgOverlay";const f=v,g=i.forwardRef(((e,s)=>{let{className:r,bsPrefix:a,as:i="a",...l}=e;return a=(0,n.oU)(a,"card-link"),(0,d.jsx)(i,{ref:s,className:t()(r,a),...l})}));g.displayName="CardLink";const N=g;var b=r(4488);const _=(0,b.A)("h6"),A=i.forwardRef(((e,s)=>{let{className:r,bsPrefix:a,as:i=_,...l}=e;return a=(0,n.oU)(a,"card-subtitle"),(0,d.jsx)(i,{ref:s,className:t()(r,a),...l})}));A.displayName="CardSubtitle";const S=A,w=i.forwardRef(((e,s)=>{let{className:r,bsPrefix:a,as:i="p",...l}=e;return a=(0,n.oU)(a,"card-text"),(0,d.jsx)(i,{ref:s,className:t()(r,a),...l})}));w.displayName="CardText";const C=w,k=(0,b.A)("h5"),R=i.forwardRef(((e,s)=>{let{className:r,bsPrefix:a,as:i=k,...l}=e;return a=(0,n.oU)(a,"card-title"),(0,d.jsx)(i,{ref:s,className:t()(r,a),...l})}));R.displayName="CardTitle";const P=R,I=i.forwardRef(((e,s)=>{let{bsPrefix:r,className:a,bg:i,text:l,border:c,body:h=!1,children:u,as:x="div",...m}=e;const j=(0,n.oU)(r,"card");return(0,d.jsx)(x,{ref:s,...m,className:t()(a,j,i&&`bg-${i}`,l&&`text-${l}`,c&&`border-${c}`),children:h?(0,d.jsx)(o,{children:u}):u})}));I.displayName="Card";const $=Object.assign(I,{Img:y,Title:P,Subtitle:S,Body:o,Link:N,Text:C,Header:j,Footer:h,ImgOverlay:f})},7491:(e,s,r)=>{r.d(s,{A:()=>v});var a=r(8139),t=r.n(a),i=r(5043),n=r(7852),d=r(2673),l=r(579);const o=i.forwardRef(((e,s)=>{let{active:r=!1,disabled:a=!1,className:i,style:n,activeLabel:o="(current)",children:c,linkStyle:h,linkClassName:u,as:x=d.A,...m}=e;const j=r||a?"span":x;return(0,l.jsx)("li",{ref:s,style:n,className:t()(i,"page-item",{active:r,disabled:a}),children:(0,l.jsxs)(j,{className:t()("page-link",u),style:h,...m,children:[c,r&&o&&(0,l.jsx)("span",{className:"visually-hidden",children:o})]})})}));o.displayName="PageItem";const c=o;function h(e,s){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;const a=i.forwardRef(((e,a)=>{let{children:t,...i}=e;return(0,l.jsxs)(o,{...i,ref:a,children:[(0,l.jsx)("span",{"aria-hidden":"true",children:t||s}),(0,l.jsx)("span",{className:"visually-hidden",children:r})]})}));return a.displayName=e,a}const u=h("First","\xab"),x=h("Prev","\u2039","Previous"),m=h("Ellipsis","\u2026","More"),j=h("Next","\u203a"),p=h("Last","\xbb"),y=i.forwardRef(((e,s)=>{let{bsPrefix:r,className:a,size:i,...d}=e;const o=(0,n.oU)(r,"pagination");return(0,l.jsx)("ul",{ref:s,...d,className:t()(a,o,i&&`${o}-${i}`)})}));y.displayName="Pagination";const v=Object.assign(y,{First:u,Prev:x,Ellipsis:m,Item:c,Next:j,Last:p})}}]);
//# sourceMappingURL=189.1f6bdb8c.chunk.js.map