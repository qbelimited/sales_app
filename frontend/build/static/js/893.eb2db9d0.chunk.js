"use strict";(self.webpackChunkSales_tracking_app=self.webpackChunkSales_tracking_app||[]).push([[893],{7893:(e,s,r)=>{r.r(s),r.d(s,{default:()=>g});var t=r(5043),a=r(7417),n=r(1072),l=r(8602),i=r(3814),c=r(4282),d=r(4196),o=r(5751),h=r(3204),x=r(1899),j=r.n(x),u=(r(5015),r(9621)),p=r(579);const g=e=>{let{showToast:s}=e;const[r,x]=(0,t.useState)([]),[g,m]=(0,t.useState)({}),[A,y]=(0,t.useState)(!0),[D,v]=(0,t.useState)(null),[f,k]=(0,t.useState)({resourceType:"",action:"",startDate:null,endDate:null}),[C,w]=(0,t.useState)(!1),[N,S]=(0,t.useState)(null),[_,T]=(0,t.useState)([]),[b,E]=(0,t.useState)([]),[F,P]=(0,t.useState)(1),[U]=(0,t.useState)(50),[R,I]=(0,t.useState)("current"),M=(0,t.useCallback)((async()=>{y(!0),v(null);try{const e=(await u.A.get("/audit_trail/")).data||[];x(e),L(e)}catch(D){console.error("Error fetching audit logs:",D),v("Failed to fetch audit logs. Please try again later."),s("danger","Failed to fetch audit logs. Please try again later.","Error")}finally{y(!1)}}),[s]),L=e=>{const s=[...new Set(e.map((e=>e.resource_type)))],r=[...new Set(e.map((e=>e.action.replace("AuditAction.",""))))];T(s),E(r)},B=(0,t.useCallback)((async()=>{try{const e=await u.A.get("/users/"),s={};e.data.users.forEach((e=>{s[e.id]=e.name})),m(s)}catch(D){console.error("Error fetching users:",D)}}),[]);(0,t.useEffect)((()=>{M(),B()}),[M,B]);const H=r.filter((e=>{const s=new Date(e.timestamp),r=new Date;return"current"===R?s>=new Date(r.setDate(r.getDate()-r.getDay())):"previous"===R?s<new Date(r.setDate(r.getDate()-r.getDay()))&&s>=new Date(r.setDate(r.getDate()-7)):s<new Date(r.setDate(r.getDate()-7))})),O=F*U,W=O-U,z=H.slice(W,O),K=e=>P(e),Q=Math.ceil(H.length/U),V=Math.max(1,F-Math.floor(2.5)),X=Math.min(Q,V+5-1);return A?(0,p.jsx)(a.A,{animation:"border"}):(0,p.jsxs)("div",{style:{marginTop:"20px",padding:"20px"},children:[(0,p.jsx)(n.A,{className:"mb-4",children:(0,p.jsx)(l.A,{children:(0,p.jsx)("h2",{children:"Audit Trail"})})}),(0,p.jsx)(i.A,{className:"mb-4",children:(0,p.jsxs)(n.A,{className:"align-items-end",children:[(0,p.jsx)(l.A,{md:2,children:(0,p.jsxs)(i.A.Control,{as:"select",value:f.resourceType,onChange:e=>k({...f,resourceType:e.target.value}),children:[(0,p.jsx)("option",{value:"",children:"Resource Type"}),_.map((e=>(0,p.jsx)("option",{value:e,children:e},e)))]})}),(0,p.jsx)(l.A,{md:2,children:(0,p.jsxs)(i.A.Control,{as:"select",value:f.action,onChange:e=>k({...f,action:e.target.value}),children:[(0,p.jsx)("option",{value:"",children:"Action"}),b.map((e=>(0,p.jsx)("option",{value:e,children:e},e)))]})}),(0,p.jsx)(l.A,{md:2,children:(0,p.jsx)(j(),{selected:f.startDate,onChange:e=>k({...f,startDate:e}),placeholderText:"Start Date",className:"form-control"})}),(0,p.jsx)(l.A,{md:2,children:(0,p.jsx)(j(),{selected:f.endDate,onChange:e=>k({...f,endDate:e}),placeholderText:"End Date",className:"form-control"})}),(0,p.jsx)(l.A,{md:2,children:(0,p.jsxs)(c.A,{variant:"primary",onClick:async()=>{y(!0),v(null);try{const e=(await u.A.post("/audit_trail/filter",f)).data||[];x(e),L(e),P(1)}catch(D){console.error("Error filtering audit logs:",D),v("Failed to filter audit logs. Please try again later."),s("danger","Failed to filter audit logs. Please try again later.","Error")}finally{y(!1)}},children:[(0,p.jsx)(h.KSO,{})," Filter"]})})]})}),D&&(0,p.jsx)("p",{className:"text-center text-danger",children:D}),(0,p.jsx)(n.A,{className:"mb-4",children:(0,p.jsxs)(l.A,{children:[(0,p.jsx)(c.A,{variant:"current"===R?"primary":"secondary",onClick:()=>I("current"),children:"Current Week"})," ",(0,p.jsx)(c.A,{variant:"previous"===R?"primary":"secondary",onClick:()=>I("previous"),children:"Previous Week"})," ",(0,p.jsx)(c.A,{variant:"older"===R?"primary":"secondary",onClick:()=>I("older"),children:"Older"})]})}),(0,p.jsxs)(d.A,{striped:!0,bordered:!0,hover:!0,responsive:!0,children:[(0,p.jsx)("thead",{children:(0,p.jsxs)("tr",{children:[(0,p.jsx)("th",{children:"#"}),(0,p.jsx)("th",{children:"Resource Type"}),(0,p.jsx)("th",{children:"Action"}),(0,p.jsx)("th",{children:"User"}),(0,p.jsx)("th",{children:"Resource ID"}),(0,p.jsx)("th",{children:"Details"}),(0,p.jsx)("th",{children:"Date"}),(0,p.jsx)("th",{children:"Actions"})]})}),(0,p.jsx)("tbody",{children:z.length>0?z.map(((e,r)=>(0,p.jsxs)("tr",{children:[(0,p.jsx)("td",{children:W+r+1}),(0,p.jsx)("td",{children:e.resource_type}),(0,p.jsx)("td",{children:e.action.replace("AuditAction.","")}),(0,p.jsx)("td",{children:g[e.user_id]||"Unknown User"}),(0,p.jsx)("td",{children:e.resource_id||"N/A"}),(0,p.jsx)("td",{children:e.details}),(0,p.jsx)("td",{children:new Date(e.timestamp).toLocaleString()}),(0,p.jsx)("td",{children:(0,p.jsxs)(c.A,{variant:"link",size:"sm",onClick:()=>(async e=>{y(!0),v(null);try{const s=await u.A.get(`/audit_trail/${e}`);S(s.data),w(!0)}catch(D){console.error("Error fetching log details:",D),s("danger","Failed to fetch log details. Please try again later.","Error")}finally{y(!1)}})(e.id),children:[(0,p.jsx)(h.__w,{})," Details"]})})]},e.id))):(0,p.jsx)("tr",{children:(0,p.jsx)("td",{colSpan:"8",className:"text-center",children:"No audit logs found"})})})]}),(0,p.jsx)(n.A,{className:"mt-3",children:(0,p.jsxs)(l.A,{className:"text-center",children:[F>1&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(c.A,{variant:"secondary",onClick:()=>K(1),className:"mx-1",children:(0,p.jsx)(h.X8f,{})}),(0,p.jsx)(c.A,{variant:"secondary",onClick:()=>K(F-1),className:"mx-1",children:(0,p.jsx)(h.QVr,{})})]}),[...Array(X-V+1).keys()].map((e=>(0,p.jsx)(c.A,{variant:F===V+e?"primary":"secondary",onClick:()=>K(V+e),className:"mx-1",children:V+e},V+e))),F<Q&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(c.A,{variant:"secondary",onClick:()=>K(F+1),className:"mx-1",children:(0,p.jsx)(h.Z0P,{})}),(0,p.jsx)(c.A,{variant:"secondary",onClick:()=>K(Q),className:"mx-1",children:(0,p.jsx)(h.eaw,{})})]})]})}),(0,p.jsxs)(o.A,{show:C,onHide:()=>w(!1),children:[(0,p.jsx)(o.A.Header,{closeButton:!0,children:(0,p.jsx)(o.A.Title,{children:"Audit Log Details"})}),(0,p.jsx)(o.A.Body,{children:N?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"ID:"})," ",N.id]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"Resource Type:"})," ",N.resource_type]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"Action:"})," ",N.action.replace("AuditAction.","")]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"User:"})," ",g[N.user_id]||"Unknown User"]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"Resource ID:"})," ",N.resource_id||"N/A"]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"Date:"})," ",new Date(N.timestamp).toLocaleString()]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"Details:"})," ",N.details]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"IP Address:"})," ",N.ip_address||"N/A"]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"User Agent:"})," ",N.user_agent||"N/A"]})]}):(0,p.jsx)("p",{children:"No details available."})}),(0,p.jsx)(o.A.Footer,{children:(0,p.jsx)(c.A,{variant:"secondary",onClick:()=>w(!1),children:"Close"})})]})]})}}}]);
//# sourceMappingURL=893.eb2db9d0.chunk.js.map