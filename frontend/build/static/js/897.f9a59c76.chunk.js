"use strict";(self.webpackChunkSales_tracking_app=self.webpackChunkSales_tracking_app||[]).push([[897],{4897:(e,a,t)=>{t.r(a),t.d(a,{default:()=>g});var r=t(5043),s=t(7417),l=t(4282),i=t(3814),n=t(4196),c=t(8861),d=t(2725),o=t(6579),m=t(7929),u=t(9621),h=t(579);const g=e=>{var a;let{showToast:t}=e;const[g,p]=(0,r.useState)([]),[x,j]=(0,r.useState)(!0),[_,v]=(0,r.useState)(null),[f,y]=(0,r.useState)(null),[b,N]=(0,r.useState)(!1),[S,A]=(0,r.useState)(!1),[w,C]=(0,r.useState)(!1),[T,F]=(0,r.useState)(null),[k,E]=(0,r.useState)(!1),[P,D]=(0,r.useState)(1),[M,I]=(0,r.useState)(1),[$,O]=(0,r.useState)(0),[q,V]=(0,r.useState)([]),[H,B]=(0,r.useState)(""),[R,K]=(0,r.useState)([]),[L,U]=(0,r.useState)([]),[z,J]=(0,r.useState)(""),[Q,W]=(0,r.useState)(""),[G,X]=(0,r.useState)(""),[Y,Z]=(0,r.useState)(""),[ee,ae]=(0,r.useState)(""),[te,re]=(0,r.useState)(""),se=JSON.parse(localStorage.getItem("user")),le=parseInt(null===se||void 0===se?void 0:se.role_id)||(null===se||void 0===se||null===(a=se.role)||void 0===a?void 0:a.id),ie=null===se||void 0===se?void 0:se.id,ne=(0,r.useCallback)((async()=>{try{const e=await u.A.get("/dropdown/",{params:{type:"users_with_roles",role_id:4}});V(e.data)}catch(_){console.error("Error fetching sales managers:",_),t("danger","Failed to fetch sales managers.","Error")}}),[t]),ce=(0,r.useCallback)((async()=>{j(!0),v(null);try{const e=await u.A.get("/sales_target/?sort_by=created_at&per_page=10&page=1"),a=parseInt(e.data.total)||e.data.total,t=await u.A.get(`/sales_target/?sort_by=created_at&per_page=${a}&page=1`),r=Array.isArray(t.data.sales_targets)?t.data.sales_targets:[],s=4===le?r.filter((e=>e.sales_manager_id===ie)):r,l=[...new Set(r.map((e=>e.target_criteria_type)))],i=[...new Set(r.map((e=>e.target_criteria_value)))];K(l),U(i);const n=s.filter((e=>{const a=!H||e.sales_manager_id===parseInt(H,10),t=!G||e.target_criteria_type===G,r=!Y||e.target_criteria_value===Y,s=!ee||!te||new Date(e.period_start).toISOString().slice(0,10)>=ee&&new Date(e.period_end).toISOString().slice(0,10)<=te;return a&&t&&r&&s}));p(n),I(Math.ceil(n.length/10)),O(n.length)}catch(e){console.error("Error fetching sales targets:",e),v("Failed to load sales targets.")}finally{j(!1)}}),[le,ie,H,G,Y,ee,te,10]);(0,r.useEffect)((()=>{ne(),ce()}),[ne,ce]);const de=()=>{N(!1),J(""),W("")},oe=e=>{y(e),A(!0),J(""),W("")},me=()=>{y(null),A(!1),J(""),W("")},ue=e=>{F(e),C(!0)},he=()=>{F(null),C(!1)},ge=async(e,a)=>{e.preventDefault();const r=new FormData(e.target),s=new Date(r.get("period_start"));s.setHours(0,0,0);const l=new Date(r.get("period_end"));if(l.setHours(0,0,0),isNaN(s.getTime())||isNaN(l.getTime()))return void t("danger","Please enter valid date and time.","Error");const i={sales_manager_id:parseInt(r.get("sales_manager_id"),10),target_sales_count:Math.round(Number(r.get("target_sales_count"))),target_premium_amount:parseFloat(r.get("target_premium_amount")),target_criteria_type:z||r.get("target_criteria_type"),target_criteria_value:Q||r.get("target_criteria_value"),period_start:s.toISOString(),period_end:l.toISOString(),is_active:!0};a?await(async e=>{try{await u.A.put(`/sales_target/${f.id}`,e),t("success","Sales target updated successfully.","Success")}catch(a){console.error("Error updating sales target:",a),t("danger","Failed to save sales target.","Error")}})(i):await(async e=>{try{await u.A.post("/sales_target/",e),t("success","Sales target created successfully.","Success")}catch(a){console.error("Error adding sales target:",a),t("danger","Failed to save sales target.","Error")}})(i),ce(),a?me():de()},pe=g.filter((e=>e.is_active)),xe=g.filter((e=>!e.is_active)),je=pe.slice(10*(P-1),10*P);return(0,h.jsxs)("div",{className:"container mt-5",children:[(0,h.jsx)("h1",{className:"text-center mb-4",children:"Manage Sales Targets"}),x&&(0,h.jsx)(s.A,{animation:"border",variant:"primary"}),_&&(0,h.jsx)("p",{className:"text-danger",children:_}),(0,h.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[(3===le||2===le)&&(0,h.jsxs)(l.A,{variant:"primary",onClick:()=>{y(null),N(!0),J(""),W("")},children:[(0,h.jsx)(o.g,{icon:m.QLR})," Add Sales Target"]}),(0,h.jsxs)("div",{className:"d-flex flex-wrap align-items-center",children:[(0,h.jsxs)(i.A.Control,{as:"select",value:H,onChange:e=>B(e.target.value),className:"me-1",style:{width:"150px"},children:[(0,h.jsx)("option",{value:"",children:"Manager"}),q.map((e=>(0,h.jsx)("option",{value:e.id,children:e.name},e.id)))]}),(0,h.jsxs)(i.A.Control,{as:"select",value:G,onChange:e=>X(e.target.value),className:"me-1",style:{width:"150px"},children:[(0,h.jsx)("option",{value:"",children:"Criteria Type"}),R.map((e=>(0,h.jsx)("option",{value:e,children:e},e)))]}),(0,h.jsxs)(i.A.Control,{as:"select",value:Y,onChange:e=>Z(e.target.value),className:"me-1",style:{width:"150px"},children:[(0,h.jsx)("option",{value:"",children:"Criteria Value"}),L.map((e=>(0,h.jsx)("option",{value:e,children:e},e)))]}),(0,h.jsx)(i.A.Control,{type:"date",value:ee,onChange:e=>ae(e.target.value),className:"me-1",style:{width:"120px"}}),(0,h.jsx)(i.A.Control,{type:"date",value:te,onChange:e=>re(e.target.value),className:"me-1",style:{width:"120px"}}),(0,h.jsx)(l.A,{variant:"primary",onClick:ce,children:"Apply"})]})]}),(0,h.jsx)(l.A,{variant:k?"primary":"secondary",onClick:()=>E(!k),className:"mb-3",children:k?"Hide Past Targets":"Show Past Targets"}),(0,h.jsx)("div",{className:"mt-3",children:(0,h.jsxs)("h5",{children:["Total Running Targets: ",$]})}),(0,h.jsxs)(n.A,{striped:!0,bordered:!0,hover:!0,responsive:!0,className:"mt-3",children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{children:"Sales Manager"}),(0,h.jsx)("th",{children:"Target Sales Count"}),(0,h.jsx)("th",{children:"Target Premium Amount"}),(0,h.jsx)("th",{children:"Criteria Type"}),(0,h.jsx)("th",{children:"Criteria Value"}),(0,h.jsx)("th",{children:"Period Start"}),(0,h.jsx)("th",{children:"Period End"}),(0,h.jsx)("th",{children:"Actions"})]})}),(0,h.jsxs)("tbody",{children:[je.map((e=>{var a;return(0,h.jsxs)("tr",{children:[(0,h.jsx)("td",{children:(null===(a=q.find((a=>a.id===e.sales_manager_id)))||void 0===a?void 0:a.name)||e.sales_manager_id}),(0,h.jsx)("td",{children:Math.round(e.target_sales_count)}),(0,h.jsx)("td",{children:parseFloat(e.target_premium_amount).toFixed(2)}),(0,h.jsx)("td",{children:e.target_criteria_type}),(0,h.jsx)("td",{children:e.target_criteria_value}),(0,h.jsx)("td",{children:new Date(e.period_start).toISOString().slice(0,10)})," ",(0,h.jsx)("td",{children:new Date(e.period_end).toISOString().slice(0,10)})," ",(0,h.jsx)("td",{children:(3===le||2===le)&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(l.A,{variant:"warning",onClick:()=>oe(e),children:[(0,h.jsx)(o.g,{icon:m.MT7})," Edit"]}),(0,h.jsxs)(l.A,{variant:"danger",onClick:()=>ue(e),children:[(0,h.jsx)(o.g,{icon:m.BeE})," Delete"]})]})})]},e.id)})),k&&xe.map((e=>{var a;return(0,h.jsxs)("tr",{className:"table-secondary",children:[(0,h.jsx)("td",{children:(null===(a=q.find((a=>a.id===e.sales_manager_id)))||void 0===a?void 0:a.name)||e.sales_manager_id}),(0,h.jsx)("td",{children:Math.round(e.target_sales_count)}),(0,h.jsx)("td",{children:parseFloat(e.target_premium_amount).toFixed(2)}),(0,h.jsx)("td",{children:e.target_criteria_type}),(0,h.jsx)("td",{children:e.target_criteria_value}),(0,h.jsx)("td",{children:new Date(e.period_start).toISOString().slice(0,10)})," ",(0,h.jsx)("td",{children:new Date(e.period_end).toISOString().slice(0,10)})," ",(0,h.jsx)("td",{children:(3===le||2===le)&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(l.A,{variant:"warning",onClick:()=>oe(e),children:[(0,h.jsx)(o.g,{icon:m.MT7})," Edit"]}),(0,h.jsxs)(l.A,{variant:"danger",onClick:()=>ue(e),children:[(0,h.jsx)(o.g,{icon:m.BeE})," Delete"]})]})})]},e.id)}))]})]}),(0,h.jsxs)(c.A,{className:"justify-content-center mt-3",children:[(0,h.jsx)(c.A.Prev,{onClick:()=>D((e=>Math.max(e-1,1))),disabled:1===P}),Array.from({length:Math.min(5,M)},((e,a)=>{const t=a+1+Math.max(0,P-3);return t<=M?(0,h.jsx)(c.A.Item,{active:t===P,onClick:()=>D(t),children:t},t):null})),(0,h.jsx)(c.A.Next,{onClick:()=>D((e=>Math.min(e+1,M))),disabled:P===M})]}),(0,h.jsxs)(d.A,{show:b,onHide:de,children:[(0,h.jsx)(d.A.Header,{closeButton:!0,children:(0,h.jsx)(d.A.Title,{children:"Add Sales Target"})}),(0,h.jsx)(d.A.Body,{children:(0,h.jsxs)("form",{onSubmit:e=>ge(e,!1),children:[(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)("label",{htmlFor:"sales_manager_id",className:"form-label",children:"Sales Manager"}),(0,h.jsxs)("select",{name:"sales_manager_id",className:"form-control",required:!0,children:[(0,h.jsx)("option",{value:"",children:"Select Manager"}),q.map((e=>(0,h.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)("label",{htmlFor:"target_sales_count",className:"form-label",children:"Target Sales Count"}),(0,h.jsx)("input",{type:"number",name:"target_sales_count",className:"form-control",required:!0})]}),(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)("label",{htmlFor:"target_premium_amount",className:"form-label",children:"Target Premium Amount"}),(0,h.jsx)("input",{type:"number",name:"target_premium_amount",className:"form-control",required:!0})]}),(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)("label",{htmlFor:"target_criteria_type",className:"form-label",children:"Target Criteria Type"}),(0,h.jsxs)("select",{name:"target_criteria_type",className:"form-control",required:!0,onChange:e=>{const a=e.target.value;J("custom"===a?"":z)},children:[(0,h.jsx)("option",{value:"",children:"Select Criteria Type"}),R.map((e=>(0,h.jsx)("option",{value:e,children:e},e))),(0,h.jsx)("option",{value:"custom",children:"Other (Input below)"})]}),""===z&&(0,h.jsx)("input",{type:"text",className:"form-control mt-2",placeholder:"Enter custom criteria type",onChange:e=>J(e.target.value)})]}),(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)("label",{htmlFor:"target_criteria_value",className:"form-label",children:"Target Criteria Value"}),(0,h.jsxs)("select",{name:"target_criteria_value",className:"form-control",required:!0,onChange:e=>{const a=e.target.value;W("custom"===a?"":Q)},children:[(0,h.jsx)("option",{value:"",children:"Select Criteria Value"}),L.map((e=>(0,h.jsx)("option",{value:e,children:e},e))),(0,h.jsx)("option",{value:"custom",children:"Other (Input below)"})]}),""===Q&&(0,h.jsx)("input",{type:"text",className:"form-control mt-2",placeholder:"Enter custom criteria value",onChange:e=>W(e.target.value)})]}),(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)("label",{htmlFor:"period_start",className:"form-label",children:"Period Start"}),(0,h.jsx)("input",{type:"date",name:"period_start",className:"form-control",required:!0})]}),(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)("label",{htmlFor:"period_end",className:"form-label",children:"Period End"}),(0,h.jsx)("input",{type:"date",name:"period_end",className:"form-control",required:!0})]}),(0,h.jsx)(l.A,{variant:"primary",type:"submit",children:"Create Target"})]})})]}),(0,h.jsxs)(d.A,{show:S,onHide:me,children:[(0,h.jsx)(d.A.Header,{closeButton:!0,children:(0,h.jsx)(d.A.Title,{children:"Edit Sales Target"})}),(0,h.jsx)(d.A.Body,{children:(0,h.jsxs)("form",{onSubmit:e=>ge(e,!0),children:[(0,h.jsx)("input",{type:"hidden",name:"id",defaultValue:f?f.id:""}),(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)("label",{htmlFor:"sales_manager_id",className:"form-label",children:"Sales Manager"}),(0,h.jsxs)("select",{name:"sales_manager_id",className:"form-control",defaultValue:f?f.sales_manager_id:"",required:!0,children:[(0,h.jsx)("option",{value:"",children:"Select Manager"}),q.map((e=>(0,h.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)("label",{htmlFor:"target_sales_count",className:"form-label",children:"Target Sales Count"}),(0,h.jsx)("input",{type:"number",name:"target_sales_count",className:"form-control",defaultValue:f?f.target_sales_count:"",required:!0})]}),(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)("label",{htmlFor:"target_premium_amount",className:"form-label",children:"Target Premium Amount"}),(0,h.jsx)("input",{type:"number",name:"target_premium_amount",className:"form-control",defaultValue:f?f.target_premium_amount:"",required:!0})]}),(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)("label",{htmlFor:"target_criteria_type",className:"form-label",children:"Target Criteria Type"}),(0,h.jsxs)("select",{name:"target_criteria_type",className:"form-control",defaultValue:f?f.target_criteria_type:"",required:!0,children:[(0,h.jsx)("option",{value:"",children:"Select Criteria Type"}),R.map((e=>(0,h.jsx)("option",{value:e,children:e},e)))]})]}),(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)("label",{htmlFor:"target_criteria_value",className:"form-label",children:"Target Criteria Value"}),(0,h.jsxs)("select",{name:"target_criteria_value",className:"form-control",defaultValue:f?f.target_criteria_value:"",required:!0,children:[(0,h.jsx)("option",{value:"",children:"Select Criteria Value"}),L.map((e=>(0,h.jsx)("option",{value:e,children:e},e)))]})]}),(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)("label",{htmlFor:"period_start",className:"form-label",children:"Period Start"}),(0,h.jsx)("input",{type:"date",name:"period_start",className:"form-control",defaultValue:f?f.period_start.slice(0,10):"",required:!0})," "]}),(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)("label",{htmlFor:"period_end",className:"form-label",children:"Period End"}),(0,h.jsx)("input",{type:"date",name:"period_end",className:"form-control",defaultValue:f?f.period_end.slice(0,10):"",required:!0})," "]}),(0,h.jsx)(l.A,{variant:"primary",type:"submit",children:"Update Target"})]})})]}),(0,h.jsxs)(d.A,{show:w,onHide:he,children:[(0,h.jsx)(d.A.Header,{closeButton:!0,children:(0,h.jsx)(d.A.Title,{children:"Confirm Deletion"})}),(0,h.jsx)(d.A.Body,{children:(0,h.jsx)("p",{children:"Are you sure you want to delete this sales target? This action cannot be undone."})}),(0,h.jsxs)(d.A.Footer,{children:[(0,h.jsx)(l.A,{variant:"secondary",onClick:he,children:"Cancel"}),(0,h.jsx)(l.A,{variant:"danger",onClick:async()=>{try{await u.A.delete(`/sales_target/${T.id}`),t("success","Sales target deleted successfully.","Success"),ce(),he()}catch(e){console.error("Error deleting sales target:",e),t("danger","Failed to delete sales target.","Error")}},children:"Delete"})]})]})]})}},8861:(e,a,t)=>{t.d(a,{A:()=>b});var r=t(8139),s=t.n(r),l=t(5043),i=t(7852),n=(t(2667),t(8232),t(1456));t(6723),t(1342);t(4723);new WeakMap;var c=t(4140),d=t(579);const o=["onKeyDown"];const m=l.forwardRef(((e,a)=>{let{onKeyDown:t}=e,r=function(e,a){if(null==e)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(a.indexOf(r)>=0)continue;t[r]=e[r]}return t}(e,o);const[s]=(0,c.Am)(Object.assign({tagName:"a"},r)),l=(0,n.A)((e=>{s.onKeyDown(e),null==t||t(e)}));return(i=r.href)&&"#"!==i.trim()&&"button"!==r.role?(0,d.jsx)("a",Object.assign({ref:a},r,{onKeyDown:t})):(0,d.jsx)("a",Object.assign({ref:a},r,s,{onKeyDown:l}));var i}));m.displayName="Anchor";const u=m,h=l.forwardRef(((e,a)=>{let{active:t=!1,disabled:r=!1,className:l,style:i,activeLabel:n="(current)",children:c,linkStyle:o,linkClassName:m,as:h=u,...g}=e;const p=t||r?"span":h;return(0,d.jsx)("li",{ref:a,style:i,className:s()(l,"page-item",{active:t,disabled:r}),children:(0,d.jsxs)(p,{className:s()("page-link",m),style:o,...g,children:[c,t&&n&&(0,d.jsx)("span",{className:"visually-hidden",children:n})]})})}));h.displayName="PageItem";const g=h;function p(e,a){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;const r=l.forwardRef(((e,r)=>{let{children:s,...l}=e;return(0,d.jsxs)(h,{...l,ref:r,children:[(0,d.jsx)("span",{"aria-hidden":"true",children:s||a}),(0,d.jsx)("span",{className:"visually-hidden",children:t})]})}));return r.displayName=e,r}const x=p("First","\xab"),j=p("Prev","\u2039","Previous"),_=p("Ellipsis","\u2026","More"),v=p("Next","\u203a"),f=p("Last","\xbb"),y=l.forwardRef(((e,a)=>{let{bsPrefix:t,className:r,size:l,...n}=e;const c=(0,i.oU)(t,"pagination");return(0,d.jsx)("ul",{ref:a,...n,className:s()(r,c,l&&`${c}-${l}`)})}));y.displayName="Pagination";const b=Object.assign(y,{First:x,Prev:j,Ellipsis:_,Item:g,Next:v,Last:f})},4196:(e,a,t)=>{t.d(a,{A:()=>c});var r=t(8139),s=t.n(r),l=t(5043),i=t(7852),n=t(579);const c=l.forwardRef(((e,a)=>{let{bsPrefix:t,className:r,striped:l,bordered:c,borderless:d,hover:o,size:m,variant:u,responsive:h,...g}=e;const p=(0,i.oU)(t,"table"),x=s()(r,p,u&&`${p}-${u}`,m&&`${p}-${m}`,l&&`${p}-${"string"===typeof l?`striped-${l}`:"striped"}`,c&&`${p}-bordered`,d&&`${p}-borderless`,o&&`${p}-hover`),j=(0,n.jsx)("table",{...g,className:x,ref:a});if(h){let e=`${p}-responsive`;return"string"===typeof h&&(e=`${e}-${h}`),(0,n.jsx)("div",{className:e,children:j})}return j}))}}]);
//# sourceMappingURL=897.f9a59c76.chunk.js.map