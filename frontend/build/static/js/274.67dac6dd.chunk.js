"use strict";(self.webpackChunkSales_tracking_app=self.webpackChunkSales_tracking_app||[]).push([[274],{1274:(e,s,n)=>{n.r(s),n.d(s,{default:()=>h});var t=n(5043),i=n(9621),r=n(4107),d=n(5751),c=n(4282),l=n(579);const o=e=>{let{showToast:s,onEndSession:n}=e;const{sessions:i,loading:o}=(0,r.Jd)(),[a,h]=(0,t.useState)(null),[u,x]=(0,t.useState)(!1),[j,m]=(0,t.useState)(null),[g,_]=(0,t.useState)({});if(o)return(0,l.jsx)("p",{children:"Loading sessions..."});const S=Array.from(new Set(i.map((e=>e.user_id)))).map((e=>i.find((s=>s.user_id===e)))).sort(((e,s)=>{const n=i.filter((s=>s.user_id===e.user_id&&s.is_active)).length;return i.filter((e=>e.user_id===s.user_id&&e.is_active)).length-n})),b=function(e){let s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return i.filter((n=>n.user_id===e&&n.is_active===s))},v=(e,s)=>{if(s){const n=new Date(s)-new Date(e);return`${Math.floor(n/6e4)} minutes`}return"Active"};return(0,l.jsxs)("div",{children:[a?(0,l.jsxs)("div",{children:[(0,l.jsx)("button",{className:"btn btn-secondary mb-3",onClick:()=>h(null),children:"Back to All Users"}),(0,l.jsxs)("table",{className:"table table-striped",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Session ID"}),(0,l.jsx)("th",{children:"User Name"}),(0,l.jsx)("th",{children:"Login Time"}),(0,l.jsx)("th",{children:"Logout Time"}),(0,l.jsx)("th",{children:"Session Duration"}),(0,l.jsx)("th",{children:"IP Address"}),(0,l.jsx)("th",{children:"Status"}),(0,l.jsx)("th",{children:"Actions"})]})}),(0,l.jsxs)("tbody",{children:[b(a).map((e=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:e.id}),(0,l.jsx)("td",{children:e.user_name}),(0,l.jsx)("td",{children:new Date(e.login_time).toLocaleString()}),(0,l.jsx)("td",{children:e.logout_time?new Date(e.logout_time).toLocaleString():"Active"}),(0,l.jsx)("td",{children:v(e.login_time,e.logout_time)}),(0,l.jsx)("td",{children:e.ip_address}),(0,l.jsx)("td",{children:e.is_active?"Active":"Inactive"}),(0,l.jsx)("td",{children:e.is_active&&(0,l.jsx)("button",{className:"btn btn-danger btn-sm",onClick:()=>{return s=e.id,n=e.user_id,m({sessionId:s,userId:n}),void x(!0);var s,n},children:"End Session"})})]},e.id))),g[a]&&b(a,!1).map((e=>(0,l.jsxs)("tr",{className:"table-secondary",children:[(0,l.jsx)("td",{children:e.id}),(0,l.jsx)("td",{children:e.user_name}),(0,l.jsx)("td",{children:new Date(e.login_time).toLocaleString()}),(0,l.jsx)("td",{children:e.logout_time?new Date(e.logout_time).toLocaleString():"Active"}),(0,l.jsx)("td",{children:v(e.login_time,e.logout_time)}),(0,l.jsx)("td",{children:e.ip_address}),(0,l.jsx)("td",{children:e.is_active?"Active":"Inactive"}),(0,l.jsx)("td",{children:"N/A"})]},e.id)))]})]}),(0,l.jsx)("button",{className:"btn btn-info btn-sm",onClick:()=>{return e=a,void _((s=>({...s,[e]:!s[e]})));var e},children:g[a]?"Hide Inactive Sessions":"Show Inactive Sessions"})]}):(0,l.jsxs)("table",{className:"table table-striped",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"User Name"}),(0,l.jsx)("th",{children:"Active Sessions Count"}),(0,l.jsx)("th",{children:"Actions"})]})}),(0,l.jsx)("tbody",{children:S.length>0?S.map((e=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:e.user_name}),(0,l.jsx)("td",{children:b(e.user_id).length}),(0,l.jsx)("td",{children:(0,l.jsx)("button",{className:"btn btn-info btn-sm",onClick:()=>h(e.user_id),children:"View All Sessions"})})]},e.user_id))):(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:"3",children:"No users with active sessions found."})})})]}),(0,l.jsxs)(d.A,{show:u,onHide:()=>x(!1),children:[(0,l.jsx)(d.A.Header,{closeButton:!0,children:(0,l.jsx)(d.A.Title,{children:"Confirm Deletion"})}),(0,l.jsx)(d.A.Body,{children:(0,l.jsx)("p",{children:"Are you sure you want to end this session? This action cannot be undone."})}),(0,l.jsxs)(d.A.Footer,{children:[(0,l.jsx)(c.A,{variant:"secondary",onClick:()=>x(!1),children:"Cancel"}),(0,l.jsx)(c.A,{variant:"danger",onClick:async()=>{j&&(await n(j.sessionId,j.userId),s("success","Session ended successfully.","Success"),x(!1),m(null))},children:"End Session"})]})]})]})};var a=n(2301);const h=e=>{let{showToast:s}=e;const[n,r]=(0,t.useState)([]),[d,c]=(0,t.useState)(!0),[h,u]=(0,t.useState)(null),x=(0,t.useCallback)((async()=>{c(!0);const e=setTimeout((()=>{s("warning","Fetching sessions is taking longer than expected.","Warning")}),5e3);try{const e=await i.A.get("/users/sessions");r(e.data.sessions)}catch(h){console.error("Error fetching sessions:",h),u("Failed to fetch user sessions."),s("danger","Failed to fetch user sessions.","Error")}finally{c(!1),clearTimeout(e)}}),[s]);(0,t.useEffect)((()=>{x()}),[x]);return(0,l.jsxs)("div",{className:"container mt-5",children:[(0,l.jsx)("h1",{className:"text-center mb-4",children:"Manage User Sessions"}),d?(0,l.jsx)(a.A,{}):(0,l.jsx)(o,{sessions:n,onEndSession:async(e,n)=>{try{await i.A.delete(`/users/${n}/sessions/${e}`),s("success","Session ended successfully.","Success"),x()}catch(h){console.error("Error ending session:",h),s("danger","Failed to end the session.","Error")}},showToast:s}),h&&(0,l.jsx)("p",{className:"text-danger",children:h})]})}}}]);
//# sourceMappingURL=274.67dac6dd.chunk.js.map