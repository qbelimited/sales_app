"use strict";(self.webpackChunkSales_tracking_app=self.webpackChunkSales_tracking_app||[]).push([[304],{2304:(e,s,r)=>{r.r(s),r.d(s,{default:()=>m});var a=r(5043),t=r(7417),l=r(1072),n=r(8602),c=r(3814),i=r(4196),o=r(4282),d=r(5751),h=r(4063),u=r(3204),x=r(9621),j=r(579);const p=e=>{let{endpoint:s,columns:r,title:p,showToast:m}=e;const[A,g]=(0,a.useState)([]),[v,y]=(0,a.useState)(!0),[b,f]=(0,a.useState)(null),[C,w]=(0,a.useState)("created_at"),[N,S]=(0,a.useState)("asc"),[k,$]=(0,a.useState)(""),[_,E]=(0,a.useState)(10),[P,H]=(0,a.useState)(1),[U,B]=(0,a.useState)(0),[F,R]=(0,a.useState)(1),[T,L]=(0,a.useState)(!1),[G,z]=(0,a.useState)(null),[D,I]=(0,a.useState)([]),[M,J]=(0,a.useState)([]),[X,q]=(0,a.useState)([]),[O,W]=(0,a.useState)(!1),[K,Q]=(0,a.useState)(""),[V,Y]=(0,a.useState)(""),[Z,ee]=(0,a.useState)(!1),[se,re]=(0,a.useState)(null),ae=(0,a.useCallback)((async()=>{try{const e=await x.A.get("/branches/?sort_by=created_at&per_page=1000&page=1");I(e.data.branches||[])}catch(b){console.error("Error fetching branches:",b)}}),[]),te=(0,a.useCallback)((async()=>{try{const e=await x.A.get("/roles/");q(e.data||[])}catch(b){console.error("Error fetching roles:",b)}}),[]),le=(0,a.useCallback)((async()=>{y(!0),f(null);try{const e=await x.A.get(s,{params:{sort_by:C,sort_direction:N,filter_by:k,per_page:_,page:P}});g(e.data.users||[]),B(e.data.total||0),R(e.data.pages||1)}catch(b){console.error("Error fetching data:",b),f("Failed to fetch data. Please try again later."),m("danger","Failed to fetch data. Please try again later.","Error")}finally{y(!1)}}),[s,C,N,k,_,P,m]);(0,a.useEffect)((()=>{le(),ae(),te()}),[le,ae,te]);const ne=e=>{J((s=>s.includes(e)?s.filter((s=>s!==e)):[...s,e]))};return v?(0,j.jsx)(t.A,{animation:"border"}):(0,j.jsxs)("div",{children:[(0,j.jsxs)(l.A,{className:"mb-3",children:[(0,j.jsx)(n.A,{children:(0,j.jsx)("h2",{children:p})}),(0,j.jsx)(n.A,{className:"text-right",children:(0,j.jsxs)("h5",{children:["Total Users: ",U]})})]}),b&&(0,j.jsx)("p",{className:"text-center text-danger",children:b}),(0,j.jsxs)(l.A,{className:"mb-3",children:[(0,j.jsx)(n.A,{md:4,children:(0,j.jsx)(c.A.Control,{type:"text",placeholder:"Filter by keyword",value:k,onChange:e=>{$(e.target.value),H(1)}})}),(0,j.jsx)(n.A,{md:4,children:(0,j.jsxs)(c.A.Control,{as:"select",value:_,onChange:e=>{E(Number(e.target.value)),H(1)},children:[(0,j.jsx)("option",{value:5,children:"5 per page"}),(0,j.jsx)("option",{value:10,children:"10 per page"}),(0,j.jsx)("option",{value:20,children:"20 per page"})]})})]}),(0,j.jsxs)(i.A,{striped:!0,bordered:!0,hover:!0,responsive:!0,children:[(0,j.jsx)("thead",{children:(0,j.jsxs)("tr",{children:[(0,j.jsx)("th",{children:"#"}),r.map((e=>{return(0,j.jsxs)("th",{onClick:()=>{return s=e.accessor,void(C===s?S((e=>"asc"===e?"desc":"asc")):(w(s),S("asc")));var s},style:{cursor:"pointer"},"aria-sort":C===e.accessor?N:"none",children:[e.Header," ",(s=e.accessor,C===s?"asc"===N?(0,j.jsx)(u.XhJ,{}):(0,j.jsx)(u.GOR,{}):(0,j.jsx)(u.MjW,{}))]},e.accessor);var s})),(0,j.jsx)("th",{children:"Actions"})]})}),(0,j.jsx)("tbody",{children:A.length>0?A.map(((e,s)=>(0,j.jsxs)("tr",{children:[(0,j.jsx)("td",{children:(P-1)*_+s+1}),r.map((s=>(0,j.jsx)("td",{children:"function"===typeof s.accessor?s.accessor(e):e[s.accessor]},s.Header))),(0,j.jsxs)("td",{children:[(0,j.jsx)(o.A,{variant:"link",size:"sm",onClick:()=>{return s=e,z({...s,role_id:s.role?s.role.id:""}),J(s.branches?s.branches.map((e=>e.id)):[]),void L(!0);var s},children:(0,j.jsx)(u.F7,{})}),(0,j.jsx)(o.A,{variant:"link",size:"sm",onClick:()=>(z(e),void W(!0)),children:(0,j.jsx)(u.pXu,{})}),(0,j.jsx)(o.A,{variant:"link",size:"sm",onClick:()=>{return s=e.id,re(s),void ee(!0);var s},children:(0,j.jsx)(u.qbC,{})})]})]},e.id))):(0,j.jsx)("tr",{children:(0,j.jsx)("td",{colSpan:r.length+2,className:"text-center",children:"No records found"})})})]}),(0,j.jsxs)(l.A,{className:"align-items-center",children:[(0,j.jsx)(n.A,{md:"auto",children:(0,j.jsxs)("p",{className:"mb-0",children:["Showing ",(P-1)*_+1," to ",Math.min(P*_,U)," of"," ",U," users"]})}),(0,j.jsx)(n.A,{md:"auto",children:(0,j.jsxs)("p",{className:"mb-0",children:["Page ",P," of ",F]})}),(0,j.jsxs)(n.A,{md:"auto",className:"ml-auto",children:[(0,j.jsx)(o.A,{variant:"primary",onClick:()=>H(P-1),disabled:1===P,children:"Previous"})," ",(0,j.jsx)(o.A,{variant:"primary",onClick:()=>H(P+1),disabled:P===F,children:"Next"})]})]}),G&&(0,j.jsxs)(d.A,{show:T,onHide:()=>L(!1),children:[(0,j.jsx)(d.A.Header,{closeButton:!0,children:(0,j.jsx)(d.A.Title,{children:"Edit User"})}),(0,j.jsx)(d.A.Body,{children:(0,j.jsxs)(c.A,{children:[(0,j.jsxs)(c.A.Group,{className:"mb-3",children:[(0,j.jsx)(c.A.Label,{children:"Name"}),(0,j.jsx)(c.A.Control,{type:"text",value:G.name,onChange:e=>z({...G,name:e.target.value})})]}),(0,j.jsxs)(c.A.Group,{className:"mb-3",children:[(0,j.jsx)(c.A.Label,{children:"Email"}),(0,j.jsx)(c.A.Control,{type:"email",value:G.email,onChange:e=>z({...G,email:e.target.value})})]}),(0,j.jsxs)(c.A.Group,{className:"mb-3",children:[(0,j.jsx)(c.A.Label,{children:"Role"}),(0,j.jsx)(c.A.Control,{as:"select",value:G.role_id||"",onChange:e=>z({...G,role_id:parseInt(e.target.value,10)}),children:X.map((e=>(0,j.jsx)("option",{value:e.id,children:e.name},e.id)))})]}),(0,j.jsxs)(c.A.Group,{className:"mb-3",children:[(0,j.jsx)(c.A.Label,{children:"Branches"}),(0,j.jsxs)(c.A.Control,{as:"select",onChange:e=>ne(parseInt(e.target.value,10)),value:"",children:[(0,j.jsx)("option",{value:"",disabled:!0,children:"Select Branch to Add"}),D.filter((e=>!M.includes(e.id))).map((e=>(0,j.jsx)("option",{value:e.id,children:e.name},e.id)))]}),(0,j.jsx)("div",{className:"mt-2",children:M.map((e=>{const s=D.find((s=>s.id===e));return(0,j.jsxs)(h.A,{pill:!0,variant:"primary",className:"mr-2",children:[s?s.name:e,(0,j.jsx)(o.A,{variant:"link",size:"sm",onClick:()=>ne(e),className:"ml-1 text-white",children:"x"})]},e)}))})]})]})}),(0,j.jsxs)(d.A.Footer,{children:[(0,j.jsx)(o.A,{variant:"secondary",onClick:()=>L(!1),children:"Close"}),(0,j.jsx)(o.A,{variant:"primary",onClick:async()=>{try{await x.A.put(`/users/${G.id}`,{...G,branches:M,role_id:parseInt(G.role_id,10)}),g((e=>e.map((e=>e.id===G.id?G:e)))),L(!1),m("success","User updated successfully.","Success")}catch(b){console.error("Error updating user:",b),m("danger","Error updating user","Error")}},children:"Save Changes"})]})]}),G&&(0,j.jsxs)(d.A,{show:O,onHide:()=>W(!1),children:[(0,j.jsx)(d.A.Header,{closeButton:!0,children:(0,j.jsx)(d.A.Title,{children:"Update Password"})}),(0,j.jsx)(d.A.Body,{children:(0,j.jsx)(c.A,{children:(0,j.jsxs)(c.A.Group,{children:[(0,j.jsx)(c.A.Label,{children:"New Password"}),(0,j.jsx)(c.A.Control,{type:"password",placeholder:"Enter new password",value:K,onChange:e=>Q(e.target.value)})]})})}),(0,j.jsxs)(d.A.Footer,{children:[(0,j.jsx)(o.A,{variant:"secondary",onClick:()=>W(!1),children:"Close"}),(0,j.jsx)(o.A,{variant:"primary",onClick:async()=>{try{await x.A.put(`/users/${G.id}/password`,{current_password:V,new_password:K}),m("success","Password updated successfully!","Success"),W(!1),Q(""),Y("")}catch(b){console.error("Password update failed:",b),m("danger","Failed to update password! Please try again.","Error")}},children:"Update Password"})]})]}),(0,j.jsxs)(d.A,{show:Z,onHide:()=>ee(!1),children:[(0,j.jsx)(d.A.Header,{closeButton:!0,children:(0,j.jsx)(d.A.Title,{children:"Confirm Deletion"})}),(0,j.jsx)(d.A.Body,{children:"Are you sure you want to delete this user? This action cannot be undone."}),(0,j.jsxs)(d.A.Footer,{children:[(0,j.jsx)(o.A,{variant:"secondary",onClick:()=>ee(!1),children:"Cancel"}),(0,j.jsx)(o.A,{variant:"danger",onClick:async()=>{try{await x.A.delete(`/users/${se}`),g(A.filter((e=>e.id!==se))),m("success","User deleted successfully","Success")}catch(b){console.error("Error deleting user:",b),m("danger","Error deleting user","Error")}finally{ee(!1),re(null)}},children:"Delete"})]})]})]})},m=e=>{let{showToast:s}=e;const r=[{Header:"Name",accessor:"name"},{Header:"Email",accessor:"email"},{Header:"Role",accessor:e=>e.role&&e.role.name?e.role.name:"No Role"},{Header:"Created At",accessor:e=>new Date(e.created_at).toLocaleDateString()}];return(0,j.jsxs)("div",{className:"container mt-5",children:[(0,j.jsx)("h1",{className:"text-center mb-4",children:"Manage Users"}),(0,j.jsx)(p,{endpoint:"/users/",columns:r,title:"Users List",showToast:s})]})}},4063:(e,s,r)=>{r.d(s,{A:()=>o});var a=r(8139),t=r.n(a),l=r(5043),n=r(7852),c=r(579);const i=l.forwardRef(((e,s)=>{let{bsPrefix:r,bg:a="primary",pill:l=!1,text:i,className:o,as:d="span",...h}=e;const u=(0,n.oU)(r,"badge");return(0,c.jsx)(d,{ref:s,...h,className:t()(o,u,l&&"rounded-pill",i&&`text-${i}`,a&&`bg-${a}`)})}));i.displayName="Badge";const o=i},1072:(e,s,r)=>{r.d(s,{A:()=>o});var a=r(8139),t=r.n(a),l=r(5043),n=r(7852),c=r(579);const i=l.forwardRef(((e,s)=>{let{bsPrefix:r,className:a,as:l="div",...i}=e;const o=(0,n.oU)(r,"row"),d=(0,n.gy)(),h=(0,n.Jm)(),u=`${o}-cols`,x=[];return d.forEach((e=>{const s=i[e];let r;delete i[e],null!=s&&"object"===typeof s?({cols:r}=s):r=s;const a=e!==h?`-${e}`:"";null!=r&&x.push(`${u}${a}-${r}`)})),(0,c.jsx)(l,{ref:s,...i,className:t()(a,o,...x)})}));i.displayName="Row";const o=i},4196:(e,s,r)=>{r.d(s,{A:()=>i});var a=r(8139),t=r.n(a),l=r(5043),n=r(7852),c=r(579);const i=l.forwardRef(((e,s)=>{let{bsPrefix:r,className:a,striped:l,bordered:i,borderless:o,hover:d,size:h,variant:u,responsive:x,...j}=e;const p=(0,n.oU)(r,"table"),m=t()(a,p,u&&`${p}-${u}`,h&&`${p}-${h}`,l&&`${p}-${"string"===typeof l?`striped-${l}`:"striped"}`,i&&`${p}-bordered`,o&&`${p}-borderless`,d&&`${p}-hover`),A=(0,c.jsx)("table",{...j,className:m,ref:s});if(x){let e=`${p}-responsive`;return"string"===typeof x&&(e=`${e}-${x}`),(0,c.jsx)("div",{className:e,children:A})}return A}))}}]);
//# sourceMappingURL=304.695a3da4.chunk.js.map